var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(z){return z.raw=z};$jscomp.createTemplateTagFirstArgWithRaw=function(z,S){z.raw=S;return z};$jscomp.arrayIteratorImpl=function(z){var S=0;return function(){return S<z.length?{done:!1,value:z[S++]}:{done:!0}}};$jscomp.arrayIterator=function(z){return{next:$jscomp.arrayIteratorImpl(z)}};
$jscomp.makeIterator=function(z){var S="undefined"!=typeof Symbol&&Symbol.iterator&&z[Symbol.iterator];if(S)return S.call(z);if("number"==typeof z.length)return $jscomp.arrayIterator(z);throw Error(String(z)+" is not an iterable or ArrayLike");};$jscomp.arrayFromIterator=function(z){for(var S,Ea=[];!(S=z.next()).done;)Ea.push(S.value);return Ea};$jscomp.arrayFromIterable=function(z){return z instanceof Array?z:$jscomp.arrayFromIterator($jscomp.makeIterator(z))};
$jscomp.getRestArguments=function(){for(var z=Number(this),S=[],Ea=z;Ea<arguments.length;Ea++)S[Ea-z]=arguments[Ea];return S};
(function(z,S,Ea,Ua,oa){function bc(q,y,C){$.ajax({url:"/ajax_get_img_data",data:{url:q},success:function(A){A.error?(loading(!1),error_dialog(A.error)):y(A.img_data,C)}})}function Lb(q,y){"toBlob"in q&&z.URL&&URL.createObjectURL?q.toBlob(function(C){y.src=URL.createObjectURL(C)}):y.src=q.toDataURL("image/png")}function jb(q,y,C,A,Y){function ma(){O.hide();$(S).off("click",ma);if(rb&&y!==rb)a:{for(var B=y,H=B.toUpperCase(),T=0;T<C.length;T++)if(C[T].toUpperCase()===H)break a;if(wb()){H=(H=localStorage.getItem("colors_used"))?
JSON.parse(H):{};H[B]=H[B]||{name:B};H[B].last_used=Date.now();H=JSON.stringify(H);try{localStorage.setItem("colors_used",H)}catch(Ia){}}}}function ja(B){B=fa(B,1,1);O.find(".color-slider-2d-wrap").css("background","rgb("+B.r+","+B.g+","+B.b+")")}function ra(B,H,T){B=fa(B,H,T);return"#"+(16>B.r?"0":"")+B.r.toString(16)+(16>B.g?"0":"")+B.g.toString(16)+(16>B.b?"0":"")+B.b.toString(16)}function fa(B,H,T){var Ia=Math.floor(6*B),Ka=6*B-Ia;B=T*(1-H);var ab=T*(1-Ka*H);H=T*(1-(1-Ka)*H);switch(Ia%6){case 0:var La=
T;var Va=H;var Wa=B;break;case 1:La=ab;Va=T;Wa=B;break;case 2:La=B;Va=T;Wa=H;break;case 3:La=B;Va=ab;Wa=T;break;case 4:La=H;Va=B;Wa=T;break;case 5:La=T,Va=B,Wa=ab}return{r:Math.round(255*La),g:Math.round(255*Va),b:Math.round(255*Wa)}}function na(){if(!wb())return[];var B=localStorage.getItem("colors_used");B=B?JSON.parse(B):{};var H=[],T;for(T in B)B.hasOwnProperty(T)&&2592E6>Date.now()-B[T].last_used&&H.push(T);H.sort(function(Ia,Ka){return B[Ka].last_used-B[Ia].last_used});return H.slice(0,20-C.length)}
function W(){for(var B="",H=0;H<C.length;H++)B+='<div class="color-box" data-color="'+C[H]+'" style="background:'+C[H]+'"></div>';var T=na();for(H=0;H<T.length;H++)B+='<div class="color-box" data-color="'+esc(T[H])+'" style="background:'+esc(T[H])+'"></div>';return B}function sa(){O||(O=$('<div class="color-popup ibox"><div class="color-panel"><div class="color-boxes">'+W()+'</div><input class="color-input" type="text" maxlength="9" tabindex="-1" value="'+y+'"/></div><div class="color-slider-2d-wrap"><div class="color-slider-2d"></div><div class="color-bg1"></div><div class="color-bg2"></div></div><div class="color-slider-wrap"><div class="color-slider"></div></div></div>'),
za=O.find(".color-input"),za.change(function(){var B=za.val();Xa(B);ma()}),O.on("click",".color-box",function(){var B=$(this).data("color");Xa(B);ma()}),O.click(cancelEvent),q.append(O),cc(O.find(".color-slider-2d-wrap"),O.find(".color-slider-2d"),function(B,H){ka=B;Ba=1-H;Xa(ra(Ma,ka,Ba))}),cc(O.find(".color-slider-wrap"),O.find(".color-slider"),function(B,H){Ma=H;ja(Ma);Xa(ra(Ma,ka,Ba))}),ja(0))}var O,za,Ma=0,ka=1,Ba=1,rb;this.getColor=function(){return y};var Xa=this.setColor=function(B){y=B;za&&
za.val(B);xb.css("background",B);A(B)};var xb=$('<div class="color-btn" style="background:'+y+'" title="'+(Y||"")+'"></div>');q.addClass("color-picker").append(xb).data("picker",this).click(function(B){cancelEvent(B);sa();if("none"===O.css("display")){O.find(".color-boxes").html(W());B=O.width();var H=q.offset(),T=H.left+q.width();H=Ea.width()-H.left;var Ia=Math.max(T,H),Ka=0;Ia<B+10&&(Ka=-(B-Ia)-10);O.css(H>T?"left":"right",Ka);O.show();Ua.click(ma);rb=y}else ma()})}function cc(q,y,C){function A(){Ua.off("vmouseup",
A).off("vmousemove",Y)}function Y(ka){ma(sa+(ka.pageX-za),O+(ka.pageY-Ma));C&&C(na/ja,W/ra);ka.preventDefault()}function ma(ka,Ba){na=0>ka?0:ka>ja-1?ja:ka;W=0>Ba?0:Ba>ra-1?ra:Ba;y.css({left:na,top:W})}var ja=q.width(),ra=q.height(),fa=y.offset(),na=fa.left,W=fa.top,sa,O,za,Ma;q.on("vmousedown",function(ka){za=ka.pageX;Ma=ka.pageY;var Ba=q.offset();ma(za-Ba.left,Ma-Ba.top);sa=na;O=W;C&&C(na/ja,W/ra);Ua.on("vmouseup",A).on("vmousemove",Y);ka.preventDefault()})}function wb(){try{var q=z.localStorage;
q.setItem("__test__","__test__");q.removeItem("__test__");return!0}catch(y){return!1}}function Mb(q,y,C,A,Y){if(!(Nb||Ra&&Ra.el().closest("body")[0])){Nb=!0;y=y?1:"";A=A||"canvas";var ma=$(".gen-anon").hasClass("checked")&&!y?1:"",ja=$(".gen-private").hasClass("checked")&&!y?1:"",ra=mm.ctx(),fa=mm.canv(),na=mm.getText();signCanvas(ra,fa.width,fa.height,67600,!0,null,Y);Y=fa.toDataURL("image/jpeg");mm.preview();C&&dc(Y,!0,fa.width,fa.height);C=mm.memeData();$.extend(C,{imgData:Y.substr(Y.search(",")+
1),text:na,type:"jpeg",anon:ma,"private":ja,isReply:y,source:A});$.ajax({url:"/ajax_meme_done_canvas",type:"post",data:C,dataType:"json",success:function(W){W.error?(loading(!1),error_dialog(W.error),Ra&&Ra.hide()):q(W,ja)},error:function(){handleRequestError();Ra&&Ra.hide()},complete:function(){Nb=!1}})}}function Jc(q,y){ec(q,y,"meme",function(){mm.reset();Ra.hide();fc()},mm.currentMeme().name||"Untitled")}function fc(){var q=$(".head");q.find(".ad")[0]&&z.deployads&&(deployads.push(function(){deployads.gpt.pubadsRefresh()}),
q=q.position().top,$w.scrollTop()>q&&z.scrollTo(0,q))}function dc(q,y,C,A){z.scrollTo(0,0);Ra=z.imgDoneBox=new Box({html:'<div id="done"><div id="done-img-wrap-wrap" style="width:'+~~C+'px"><div id="done-img-wrap" style="padding-bottom:'+(C?A/C*100:0)+'%"><img id="done-img"'+(q?' src="'+q+'"':"")+'/></div></div><div id="done-info"></div><div id="done-msgs"></div><div id="done-share"></div><div id="done-embed-codes">'+(y?'<div class="load"></div>':"")+'</div><div id="done-btns"></div></div>',bg:"transparent",
top:20,hideX:!0,noMaskClick:!0})}function ec(q,y,C,A,Y,ma,ja,ra){var fa={meme:"jpg",gif:"gif",pie:"png",demotivational:"jpg"}[C],na=parseInt(q.iid).toString(36),W=!0,sa=$("#done-img"),O=$("#done-embed-codes");$("#done-img-wrap-wrap").css("width",ja);$("#done-img-wrap").css("padding-bottom",ra/ja*100+"%");if(!sa.attr("src"))y||sa.attr("crossorigin","anonymous"),sa.attr("src",(y?I.user.id?"/i-view/":"//i2.imgflip.com/":IMAGE_DOMAIN)+na+"."+fa);else if(!y){var za=new Image;$(za).load(function(){sa.attr("src",
$(this).attr("src"))});za.src=IMAGE_DOMAIN+na+"."+fa}Ua.on("contextmenu","#done-img",function(){W=!1});O.html(embedCodes(na,fa,y,!y&&"gif"!==C,C,q.has_gif_video,ja,ra)).find(".img-code").click(function(){$(this).select();W=!1}).on("focus",function(){W=!1});y||I.user.id?y||(C='<div class="done-msg">',C=(ja=GET().stream)?C+('<button type="button" id="done-submit" class="b but">Post to '+esc(ja)+" stream</button>"):C+'<button type="button" id="done-submit" class="a">Post to an Imgflip stream</button>',
O.after(C+"</div>"),$("#done-submit").click(function(){W=!1;submitImg(q.iid)})):(C='<div class="done-msg">You are not logged in! If you want to claim or delete this image, <a class="done-link" target="_blank" href="/login?claim_iid='+(q.iid+'">Login and claim it</a>'),C+=' or <a class="done-link" target="_blank" href="/signup?claim_iid='+q.iid+'">Signup and claim it</a>',O.after(C+"</div>"));C=$('<button type="button" class="l but">'+z.BACK_SVG+"Edit</button>").click(function(){W&&$.ajax({url:"/ajax_delete_creation",
type:"post",data:{iid:q.iid}});Ra.hide();fc();ma&&ma()});A=$('<button type="button" class="l but">New'+z.NEXT_SVG+"</button>").click(A);O=$("#done-btns");O.html(C);if(!y||I.user.id)C=$("<a class='l but' href='"+((y?"/i-page/":"gif"===fa?"/gif/":"/i/")+na)+"'>Image page</a>"),C.click(function(){W=!1}),O.append(C);if(y)y="This image is private. It will only be stored on imgflip servers long enough for you to download it.",I.user.id&&(y='This image is private. Only you can view or download it. View or delete it from <a href="/creations">My Images</a>.'),
$("#done-msgs").append('<div class="done-msg">'+y+"</div>");else $("#done-share").html(getShareButtonsHtml(na,fa,Y,!0)).on("click",".shr-btn,.shr-btn-device",function(){W=!1});O.append(A)}var Kc=z.File&&z.FileReader&&z.FileList,Ra,Lc={blank:"Blank Template",ai:"Template from AI"},gc="Cartoon;Digital Art;Painting;Pencil Drawing;Minimalism;Pixel Art;Watercolor;Line Art;Retro;Vintage;Psychadelic;Cyberpunk;Grunge;Gothic;Surreal;Abstract;Pop Art".split(";");MemeMaker=function(q,y,C,A){function Y(a){ma(a);
for(a=0;a<m.length;a++)m[a].autoResize(J().w,J().h,!1)}function ma(a){a>Z&&(a=Z);var b=J().h/J().w*a;yb&&b>yb&&(a*=yb/b);Ob=Fa||a;Fa=a;aa=Fa/J().w;Aa.width(Fa)}function ja(a,b){if(pa&&!(1>Math.abs(pa.width-a)&&1>Math.abs(pa.height-b))&&(Na&&(!Sa||1<=Math.abs(Sa.width-a)||1<=Math.abs(Sa.height-b))&&(Sa=S.createElement("canvas"),Sa.width=pa.width,Sa.height=pa.height,Sa.getContext("2d").drawImage(pa,0,0)),pa.width=a,pa.height=b,Na)){var d=ha.imageSmoothingQuality;ha.imageSmoothingQuality="high";ha.drawImage(Sa,
0,0,Z,Ga);ha.imageSmoothingQuality=d}}function ra(){var a="Generate meme text with AI.";I.done&&(a=proType()?a+' <span class="mm-ai-pro-tag">PRO</span>':I.user.id?a+(' <span class="mm-ai-nowrap">'+I.user.free_openai_memes_left+"/10 free left this month.</span>"):a+' <span class="mm-ai-nowrap">10 free per month. Requires <span class="a show-login">login</span>.</span>');L.find(".mm-ai-info").html(a)}function fa(){return I.done?I.user.id?I.user.email_verified||proType()?!0:(error_dialog("Your account email must be verified to use AI features. This is to prevent abuse (Imgflip does not send marketing spam). Visit your Imgflip settings to change your email or send another verification email. You can also subscribe to Pro to bypass verification."),
!1):(showLogin("Login is required to use AI features."),!1):notLoadedError()}function na(){if(fa())if(0>=I.user.free_openai_memes_left&&!proType())kb("AI Gen","You have used your 10 free AI generations this month. Upgrade for unlimited access.");else{var a=mm.memeData(1,1);loadingEl(L.find(".mm-ai-generate"),!0);$.ajax({url:"/ajax_ai_meme_custom",type:"post",dataType:"json",data:{subject:L.find(".mm-ai-subject").val(),num_boxes:a.boxes.length,template:a.template,template_url:a.template_url},success:function(b){if(b.error)error_dialog(b.error);
else{for(var d=0;d<b.texts.length;d++)m[d]&&m[d].$edit.find(".mm-text").val(b.texts[d]).change();I.user.free_openai_memes_left--;ra()}},complete:function(){loadingEl(L.find(".mm-ai-generate"),!1)}})}}function W(){return Math.round(Math.max(50,.1*(Z||0)))}function sa(a){return a.effect_img?a.effect_img.src:0===a.id?a.img?a.img.src:"":a.url_name?"/s/meme/"+a.url_name+"."+a.file_type:"https:"+IMAGE_DOMAIN+(+a.id).toString(36)+"."+a.file_type+"?a"+Math.round(Date.now()/1E3/3600)+("imgflip.com"!==z.location.hostname?
"&j":"")}function O(a,b){if(hc)return a;500>a&&(b*=500/a,a=500);if(25E4>a*b){var d=b/a;a=Math.sqrt(25E4/d);b=d*a}return Math.min(a,Math.max(500,a/b*500))}function za(){var a={};L.find(".mm-effect").each(function(){var e=$(this).find("input").val();0<e&&(a[$(this).data("type")]=+e)});q[ta].effect_img=null;if(Object.keys(a).length){var b=sa(J()),d=new Image;"http"===b.substr(0,4)&&d.setAttribute("crossorigin","anonymous");$(d).load(function(){var e=S.createElement("canvas"),f=e.getContext("2d");e.width=
Z;e.height=Ga;f.drawImage(d,0,0,d.width,d.height,0,0,Z,Ga);var g=f.getImageData(0,0,Z,Ga),h=function(k){f.putImageData(k,0,0);var l=new Image;$(l).load(function(){q[ta].effects=a;q[ta].effect_img=l;D.select(ta,!1)});l.src=e.toDataURL("image/png")};a.smart_posterize&&(g=Ma(f,g,.01*a.smart_posterize));a.median_filter&&(g=ka(f,g,a.median_filter));a.blur&&(g=rb(f,g,a.blur));a.sharpen&&(g=Ba(f,g,3,.05*a.sharpen));a.grayscale&&(g=xb(f,g,.01*a.grayscale));a.sepia&&(g=B(f,g,.01*a.sepia));a.invert&&(g=H(f,
g,.01*a.invert));a.brightness&&(g=T(f,g,.01*a.brightness-1));a.jpeg_degrade?Xa(g,a.jpeg_degrade,oa,function(k){a.jpeg_min_quality?Xa(k,1,1-.01*a.jpeg_min_quality,h):h(k)}):a.jpeg_min_quality?Xa(g,1,1-.01*a.jpeg_min_quality,h):h(g)});d.src=b}else q[ta].effects=null,D.select(ta,!1)}function Ma(a,b,d){var e=255*d;b=Ba(a,b,1,2);d=a.createImageData(b);var f=b.width,g=b.height,h=b.data,k=Array(f*g),l=0;b=[];for(var c=0;c<g;c++)for(var n=0;n<f;n++){var p=c*f+n;if(!k[p]){k[p]=!0;l++;for(var t=h[4*p],E=h[4*
p+1],M=h[4*p+2],P=h[4*p+3],Q=[p],r=[p];r.length;){var v=r.pop();p=[v-1,v+1,v-f,v+f];for(var u=0;u<p.length;u++){var w=p[u];if(!(k[w]||0>w||w>=f*g)){var F=h[4*w],X=h[4*w+1],V=h[4*w+2];v=h[4*w+3];Math.abs(F-t)<e&&Math.abs(X-E)<e&&Math.abs(V-M)<e&&Math.abs(v-P)<e&&(Q.push(w),r.unshift(w),k[w]=!0,l++,t+=(F-t)/Q.length,E+=(X-E)/Q.length,M+=(V-M)/Q.length,P+=(v-P)/Q.length)}}}t=Math.round(t);E=Math.round(E);M=Math.round(M);P=Math.round(P);50>Q.length&&b.push([Q,t,E,M,P]);for(u=0;u<Q.length;u++)v=Q[u],d.data[4*
v]=t,d.data[4*v+1]=E,d.data[4*v+2]=M,d.data[4*v+3]=P}}for(u=0;u<b.length;u++){Q=b[u][0];e=b[u][1];h=b[u][2];k=b[u][3];l=b[u][4];p=[];for(c=0;c<Q.length;c++)v=Q[c],p.push(v-1,v+1,v-f,v+f);n=Infinity;for(c=0;c<p.length;c++)if(v=p[c],!(0>v||v>=f*g)&&(F=d.data[4*v],X=d.data[4*v+1],V=d.data[4*v+2],v=d.data[4*v+3],t=Math.abs(F-e)+Math.abs(X-h)+Math.abs(V-k)+Math.abs(v-l),0<t&&t<n)){n=t;var la=[F,X,V,v]}for(c=0;c<Q.length;c++)v=Q[c],d.data[4*v]=la[0],d.data[4*v+1]=la[1],d.data[4*v+2]=la[2],d.data[4*v+3]=
la[3]}return d=ka(a,d,2)}function ka(a,b,d){d=Math.round(d);a=a.createImageData(b);var e=b.width,f=b.height;b=b.data;for(var g=0;g<e;g++)for(var h=0;h<f;h++){for(var k=Array(103),l=0,c=g-d;c<=g+d;c++)for(var n=h-d;n<=h+d;n++)if(0<=c&&c<e&&0<=n&&n<f){var p=[b[n*e*4+4*c],b[n*e*4+4*c+1],b[n*e*4+4*c+2],b[n*e*4+4*c+3]],t=Math.round((p[0]+p[1]+p[2]+p[3])/10);k[t]=k[t]||[];k[t].push(p);l++}p=0;l=Math.floor(l/2);c=0;a:for(;c<k.length;c++)if(k[c])for(n=0;n<k[c].length;n++)if(p++,p>=l){var E=k[c][n];break a}a.data[h*
e*4+4*g]=E[0];a.data[h*e*4+4*g+1]=E[1];a.data[h*e*4+4*g+2]=E[2];a.data[h*e*4+4*g+3]=E[3]}return a}function Ba(a,b,d,e){a=a.createImageData(b);var f=b.width,g=b.height;b=b.data;for(var h=0;h<f;h++)for(var k=0;k<g;k++){for(var l=b[k*f*4+4*h],c=b[k*f*4+4*h+1],n=b[k*f*4+4*h+2],p=b[k*f*4+4*h+3],t=0,E=0,M=0,P=0,Q=0,r=h-d;r<=h+d;r++)for(var v=k-d;v<=k+d;v++)0<=r&&r<f&&0<=v&&v<g&&(r!==h||v!==k)&&(t+=b[v*f*4+4*r]-l,E+=b[v*f*4+4*r+1]-c,M+=b[v*f*4+4*r+2]-n,P+=b[v*f*4+4*r+3]-p,Q++);a.data[k*f*4+4*h]=Math.min(255,
Math.max(0,l-Math.round(t/Q*e)));a.data[k*f*4+4*h+1]=Math.min(255,Math.max(0,c-Math.round(E/Q*e)));a.data[k*f*4+4*h+2]=Math.min(255,Math.max(0,n-Math.round(M/Q*e)));a.data[k*f*4+4*h+3]=Math.min(255,Math.max(0,p-Math.round(P/Q*e)))}return a}function rb(a,b,d){d=Math.round(d);a=a.createImageData(b);var e=b.width,f=b.height;b=b.data;for(var g=0;g<e;g++)for(var h=0;h<f;h++){for(var k=0,l=0,c=0,n=0,p=0,t=g-d;t<=g+d;t++)for(var E=h-d;E<=h+d;E++)0<=t&&t<e&&0<=E&&E<f&&(k+=b[E*e*4+4*t],l+=b[E*e*4+4*t+1],c+=
b[E*e*4+4*t+2],n+=b[E*e*4+4*t+3],p++);a.data[h*e*4+4*g]=Math.round(k/p);a.data[h*e*4+4*g+1]=Math.round(l/p);a.data[h*e*4+4*g+2]=Math.round(c/p);a.data[h*e*4+4*g+3]=Math.round(n/p)}return a}function Xa(a,b,d,e){var f=a.width,g=a.height,h=S.createElement("canvas");h.width=f;h.height=g;var k=h.getContext("2d");k.putImageData(a,0,0);var l=function(){var c=h.toDataURL("image/jpeg",d!==oa?d:.5+.3*Math.random()),n=new Image;$(n).load(function(){k.drawImage(n,0,0);b--;0<b?l():e(k.getImageData(0,0,f,g))});
n.src=c};l()}function xb(a,b,d){a=a.createImageData(b);var e=b.width,f=b.height;b=b.data;for(var g=0;g<e;g++)for(var h=0;h<f;h++){var k=b[h*e*4+4*g],l=b[h*e*4+4*g+1],c=b[h*e*4+4*g+2],n=b[h*e*4+4*g+3],p=Math.round((k+l+c)/3);a.data[h*e*4+4*g]=Math.min(255,Math.max(0,k+(p-k)*d));a.data[h*e*4+4*g+1]=Math.min(255,Math.max(0,l+(p-l)*d));a.data[h*e*4+4*g+2]=Math.min(255,Math.max(0,c+(p-c)*d));a.data[h*e*4+4*g+3]=n}return a}function B(a,b,d){a=a.createImageData(b);var e=b.width,f=b.height;b=b.data;for(var g=
0;g<e;g++)for(var h=0;h<f;h++){var k=b[h*e*4+4*g],l=b[h*e*4+4*g+1],c=b[h*e*4+4*g+2],n=b[h*e*4+4*g+3];a.data[h*e*4+4*g]=Math.min(255,Math.max(0,k*(1-.607*d)+.769*l*d+.189*c*d));a.data[h*e*4+4*g+1]=Math.min(255,Math.max(0,.349*k*d+l*(1-.314*d)+.168*c*d));a.data[h*e*4+4*g+2]=Math.min(255,Math.max(0,.272*k*d+.534*l*d+c*(1-.869*d)));a.data[h*e*4+4*g+3]=n}return a}function H(a,b,d){a=a.createImageData(b);var e=b.width,f=b.height;b=b.data;for(var g=0;g<e;g++)for(var h=0;h<f;h++){var k=b[h*e*4+4*g],l=b[h*
e*4+4*g+1],c=b[h*e*4+4*g+2],n=b[h*e*4+4*g+3],p=(255-l-l)*d,t=(255-c-c)*d;a.data[h*e*4+4*g]=Math.min(255,Math.max(0,k+(255-k-k)*d));a.data[h*e*4+4*g+1]=Math.min(255,Math.max(0,l+p));a.data[h*e*4+4*g+2]=Math.min(255,Math.max(0,c+t));a.data[h*e*4+4*g+3]=n}return a}function T(a,b,d){a=a.createImageData(b);var e=b.width,f=b.height;b=b.data;for(var g=0;g<e;g++)for(var h=0;h<f;h++){var k=b[h*e*4+4*g+1],l=b[h*e*4+4*g+2],c=b[h*e*4+4*g+3];a.data[h*e*4+4*g]=Math.min(255,Math.max(0,b[h*e*4+4*g]+255*d));a.data[h*
e*4+4*g+1]=Math.min(255,Math.max(0,k+255*d));a.data[h*e*4+4*g+2]=Math.min(255,Math.max(0,l+255*d));a.data[h*e*4+4*g+3]=c}return a}function Ia(){ia=ba.find(".mm-spacing-type").val();Ja=ba.find(".mm-spacing-color").val();ba.find(".mm-spacing-color-picker").toggleClass("display-none","custom"!==Ja);Ja="custom"===Ja?zb:Ja;lb=ba.find(".mm-spacing-size").val();var a=ba.find(".mm-spacing-settings"),b=q.spaced?q.spaced.w:J().w,d=q.spaced?q.spaced.h:J().h;if(ia){a.show();var e=ua!==oa?ua:ta,f=q[e],g=sa(f),
h=new Image;"http"===g.substr(0,4)&&h.setAttribute("crossorigin","anonymous");var k=function(){var l=S.createElement("canvas"),c=l.getContext("2d"),n=g?h.width:f.w,p=g?h.height:f.h,t=Math.round(lb/100*p);l.width=n;l.height=p+t*("top_bottom"===ia?2:1);var E="white"===Ja?"#fff":"black"===Ja?"#000":Ja;if("auto"===Ja){c.drawImage(h,0,0,n,t,0,0,n,t);E=Ka(c.getImageData(0,0,n,t));c.drawImage(h,0,p-t,n,t,0,0,n,t);var M=Ka(c.getImageData(0,0,n,t));if("top"===ia)var P=E;else if("bottom"===ia)P=M;else if("top_bottom"===
ia){P=[];for(var Q=0;4>Q;Q++)P[Q]=Math.round((E[Q]+M[Q])/2)}E="rgba("+P[0]+","+P[1]+","+P[2]+","+P[3]+")"}P=0;if("top"===ia||"top_bottom"===ia)P+=t,c.fillStyle=E,c.fillRect(0,0,n,t);g?c.drawImage(h,0,P):c.clearRect(0,P,n,p);if("bottom"===ia||"top_bottom"===ia)c.fillStyle=E,c.fillRect(0,P+p,n,t);var r=new Image;$(r).load(function(){var v=0;q.spaced&&"bottom"!==q.spaced.spacing_type&&(v-=q.spaced.spacing_height);"bottom"!==ia&&(v+=t);ab(v,r.height,f.h,b,d);ua=e;q.spaced={id:0,templates:f.templates||
[{id:f.id,url:f.template_url}],name:"Spaced Image",spacing_type:ia,spacing_height:t,img:r,w:r.width,h:r.height};D.select("spaced",!1);a.find(".mm-toggle-drag").hasClass("checked")||bb(!0);A.spacingUpdated&&A.spacingUpdated("bottom"!==ia?t:0,"top"!==ia?t:0)});Lb(l,r)};g?($(h).load(k),h.src=g):k()}else ua!==oa&&("top"===q.spaced.spacing_type||"top_bottom"===q.spaced.spacing_type?ab(-q.spaced.spacing_height,q[ua].h,q[ua].h,b,d):ab(0,q[ua].h,q[ua].h,b,d),D.select(ua,!1,!1),ua=oa),delete q.spaced,a.hide(),
A.spacingUpdated&&A.spacingUpdated(0,0)}function Ka(a){for(var b=a.data,d=0,e=0,f=0,g=0,h=0;100>h;h++){var k=Math.random()*a.width>>0,l=Math.random()*a.height>>0;d+=b[l*a.width*4+4*k];e+=b[l*a.width*4+4*k+1];f+=b[l*a.width*4+4*k+2];g+=b[l*a.width*4+4*k+3]}return[Math.round(d/100),Math.round(e/100),Math.round(f/100),Math.round(g/100)]}function ab(a,b,d,e,f){for(var g=!1,h=!1,k=0;k<m.length;k++){var l=m[k].getVals();!g&&("top"===ia||"top_bottom"===ia)&&l.w>.8*e&&l.y<.1*f?(l.x=5,l.y=5,l.w=e-10,l.h=lb/
100*d-10,g=!0):!h&&("bottom"===ia||"top_bottom"===ia)&&l.w>.8*e&&l.y+l.h>.9*f?(l.x=5,l.y=b-lb/100*d+5,l.w=e-10,l.h=lb/100*d-5-13,h=!0):(l.y+=a,5>l.y&&(l.y=5),l.y+l.h>b-13&&(l.y=b-l.h-13));m[k].setVals(l.x,l.y,l.w,l.h,l.rotation)}}function La(){var a=~~ba.find(".mm-blank-width").val(),b=~~ba.find(".mm-blank-height").val();if(20<a/b||20<b/a)error_dialog('Ratio of image dimensions cannot be greater than 20:1. If you are trying to add multiple images in a chain, you can use the "Add Image" button instead.');
else{ba.find(".mm-blank-ratio").each(function(){$(this).toggleClass("selected",.01>Math.abs($(this).data("w")/$(this).data("h")-a/b))});var d=S.createElement("canvas");d.width=a;d.height=b;var e=new Image;$(e).load(function(){q.blank={id:0,name:"Blank Template",img:e,w:e.width,h:e.height,has_transparency:1,template_url:"_blank:"+a+"x"+b};D.select("blank","blank"!==ta);for(var f=0;f<m.length;f++)m[f].constrainVals()});Lb(d,e)}}function Va(){var a=$(this);a=a.data("w")/a.data("h");var b=~~ba.find(".mm-blank-width").val();
ba.find(".mm-blank-height").val(Math.round(b/a));La()}function Wa(){if(!ic()||confirm("Rotating the template will remove the extra text/image boxes that you added. Continue?")){ia&&ba.find(".mm-spacing-type").val("").change();var a=J(),b=a.w;a.w=a.h;a.h=b;a.rotation=270===a.rotation?0:~~a.rotation+90;D.select(ta)}}function ic(){var a=J().default_settings?JSON.parse(J().default_settings).length:2;return m.length>a?!0:!1}function Mc(){for(var a="",b=$jscomp.makeIterator(gc),d=b.next();!d.done;d=b.next())d=
d.value,a+=cb(d,!1,{className:"mm-ai-img-tag-"+d.replace(" ","-")});b="pro"===proType()?icon("check")+"You have unlimited AI templates with Pro":"pro_basic"===proType()?icon("check")+"You have 300 AI templates/mo with Pro Basic":I.user.id?I.user.email_verified?I.user.free_ai_imgs_left+'/1 free AI templates left this month.\n\t\t\t\t\t<span class="mm-ai-img-upgrade a">Upgrade</span>':"To use AI features, verify your email (check your inbox or visit your Settings)":'<div>To use AI features, <span class="a show-login">Log in</span> with a verified email</div>';
var e=new Box({html:'<div class="mm-ai-img-popup">\n\t\t\t\t\t<div class="mm-ai-img-title">'+b+'</div>\n\t\t\t\t\t<div class="mm-ai-img-label">Describe the template</div>\n\t\t\t\t\t<input type="text" class="mm-ai-img-subject" placeholder="Cute kitten sitting on a puppy"/>\n\t\t\t\t\t<div class="mm-ai-img-label">Style tags (optional)</div>\n\t\t\t\t\t<div class="mm-ai-img-tags">'+a+'</div>\n\t\t\t\t\t<div class="mm-ai-img-btns">\n\t\t\t\t\t\t<button type="button" class="mm-ai-img-generate-btn b but">AI-Generate</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="mm-ai-img-choices-wrap display-none">\n\t\t\t\t\t\t<div class="mm-ai-img-label">Choose an image</div>\n\t\t\t\t\t\t<div class="mm-ai-img-choices"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>',
noMaskClick:!0}),f=e.el(),g=f.find(".mm-ai-img-generate-btn");g.on("click",function(){if(fa()&&!g.hasClass("load-wrap"))if(0>=I.user.free_ai_imgs_left&&!proType())kb("AI Img Gen","You have used your free AI templates for this month. Upgrade to Pro for unlimited access, or Pro Basic for 300 generations per month.");else{var h=f.find(".mm-ai-img-subject").val(),k=gc.filter(function(p){return f.find(".mm-ai-img-tag-"+p.replace(" ","-")).hasClass("checked")});if(h||k.length){loadingEl(g,!0);for(var l=
[],c=proType()?2:1,n=0;n<c;n++)l.push($.ajax({url:"/ajax_ai_img_create",type:"post",dataType:"json",data:{subject:h,tags:k}}));$.when.apply($,$jscomp.arrayFromIterable(l)).done(function(){var p=$jscomp.getRestArguments.apply(0,arguments);p=1===l.length?[p]:p;var t=[];p=$jscomp.makeIterator(p);for(var E=p.next();!E.done;E=p.next())E=E.value[0],E.error?error_dialog(E.error):t.push(E.urls[0]);t=t.map(function(M){return'<img src="'+M+'"/>'}).join("");f.find(".mm-ai-img-choices").html(t);f.find(".mm-ai-img-choices-wrap").removeClass("display-none");
proType()||I.user.free_ai_imgs_left--;loadingEl(g,!1)})}else MSG("Please enter a subject or select styles","red")}});f.on("click",".mm-ai-img-choices img",function(){var h=$(this).attr("src");e.hide();jc();var k=f.find(".mm-ai-img-subject").val().trim();$("#mm-upload-name").val(k);$("#mm-upload-url").val(h).change()});f.on("click",".mm-ai-img-upgrade",function(){kb("AI Img Gen","Upgrade to Pro for unlimited AI templates, or Pro Basic for 300 generations per month")})}function jc(){var a='<div id="mm-upload"><div id="mm-upload-file-btn" class="l but">Upload image from your device<input id="mm-upload-file" type="file" class="hidden-file-input"/></div><div id="mm-upload-or">OR</div><input id="mm-upload-url" type="url" placeholder="Paste image or image URL"/><div id="mm-upload-btns" class="display-none"><button type="button" class="mm-upload-rotate l but sml">'+
ROTATE_SVG+'</button><button type="button" class="mm-upload-flip l but sml">flip</button></div><div id="mm-upload-img-preview-wrap"></div><div id="mm-upload-public-wrap">'+cb("Allow this template to be shared publicly",!1,{id:"mm-upload-public"})+'</div><div id="mm-upload-public-settings">Name <input id="mm-upload-name" type="text" maxlength="64" placeholder="e.g. X All the Y"/>Alternate Names (comma-separated) <input id="mm-upload-alt-names" type="text" maxlength="255" placeholder="e.g. All the Things"/>Description <textarea id="mm-upload-description" maxlength="512" placeholder="e.g. history of the meme and how it should be used"></textarea>'+
(I.user.id?cb("Anonymous <small>(not shown with your username)</small>",!1,{id:"mm-upload-anon"}):"")+'</div><button type="button" id="mm-upload-btn" class="l but">Upload</button></div>';Pb=new Box({html:a,w:360});a=Pb.el();var b=$("#mm-upload-img-preview-wrap");$("#mm-upload-public").change(function(){$("#mm-upload-public-settings").toggle($(this).hasClass("checked"))});$("#mm-upload-btn").on("click",function(){var d=!$("#mm-upload-public").hasClass("checked");Ha?d?Ha?(loading("Uploading image"),
Nc(Ha.getFinalDataUrl("image/png"),Ab)):MSG("No image selected","red"):(loading("Uploading new template"),$.ajax({url:"/ajax_upload_template",type:"post",dataType:"json",data:{img_data:Ha.getFinalDataUrl("image/png"),template_url:Ab,template_name:$("#mm-upload-name").val(),template_alt_names:$("#mm-upload-alt-names").val(),template_description:$("#mm-upload-description").val(),template_anon:$("#mm-upload-anon").hasClass("checked")?1:0},success:function(e){e.error?(loading(!1),error_dialog(e.error)):
z.location=e.url}})):MSG("No file or URL selected","red")});$("#mm-upload-file").change(function(){this.files[0]&&kc(b,this.files[0])});$("#mm-upload-url").on("keyup change paste",function(d){var e=(d.originalEvent||d).clipboardData;if(e&&e.items){e=e.items;for(var f=0;f<e.length;f++)if(0===e[f].type.indexOf("image")){var g=e[f].getAsFile();if(g)return kc(b,g,!0),cancelEvent(d)}}Oc($(this),b)});a.on("click",".mm-upload-rotate",function(){Ha&&Ha.rotateClockwise()});a.on("click",".mm-upload-flip",function(){Ha&&
Ha.flipHorizontal()})}function kc(a,b,d){if(0!==b.type.indexOf("image"))MSG("File is not an image","red");else{a.show();var e=new FileReader;e.onload=function(f){Ha=new ImageCropper(a,a.width(),a.width());Ha.setSrc(f.target.result,b.name);$("#mm-upload-btns").removeClass("display-none");Ab=(d?"paste:":"")+b.name};e.readAsDataURL(b)}}function Nc(a,b){var d=new Image;$(d).load(function(e){q.custom={id:0,name:"Custom Image",img:d,w:d.width,h:d.height,template_url:b||""};D.select("custom");loading(!1)});
d.src=a;Pb.hide()}function Bb(a){if(mb[a]!==oa)return mb[a];if("fonts"in S&&"check"in S.fonts)return mb[a]=S.fonts.check("15px '"+a+"'"),mb[a];nb||(nb=$("<canvas/>")[0].getContext("2d"),nb.font="72px monospace",lc=nb.measureText("abcdefghijklmnopqrstuvwxyz0123456789\u4f60\u3053\u0645\u0c4b\u0bb5").width);nb.font="72px '"+a+"', monospace";var b=nb.measureText("abcdefghijklmnopqrstuvwxyz0123456789\u4f60\u3053\u0645\u0c4b\u0bb5").width!==lc;return mb[a]=b}function Pc(a,b){for(var d=0;d<a.length;d++)if(a[d].toLowerCase()===
b)return!0;return!1}function Qc(a){var b='<div class="mm-font-selector">',d=Rc();if(d.length){b+='<div class="mm-font-section-label">Recent Fonts</div>';for(var e=0;e<d.length;e++)b+=sb(d[e].name,d[e].src);Qb(d)}b+='<div class="mm-font-section-label">Web Fonts</div>';for(e=0;e<tb.length;e++)d=tb[e],Bb(d)&&(b+=sb(d));b=mb[Rb[0]]!==oa?b+mc():b+'<button type="button" class="mm-font-show-more l but down-arrow">More fonts on your device</button>';b=Ya.length?b+Sb():b+'<button type="button" class="mm-font-show-google l but down-arrow">Google free fonts</button>';
var f=new Box({html:b}),g=f.el().find(".mm-font-selector");g.on("click",".mm-font-item",function(){var h=$(this).data("font"),k=$(this).data("src");f.hide();a&&a(h);a:{for(var l=h.toUpperCase(),c=0;c<tb.length;c++)if(tb[c].toUpperCase()===l)break a;if(wb()){l=(l=localStorage.getItem("fonts_used"))?JSON.parse(l):{};l[h]=l[h]||{name:h,src:k};l[h].last_used=Date.now();l=JSON.stringify(l);try{localStorage.setItem("fonts_used",l)}catch(n){}}}});g.on("click",".mm-font-show-more",function(){$(this).after(mc());
$(this).remove()});g.on("click",".mm-font-add-btn",function(){var h=g.find(".mm-font-add-input"),k=h.val();if(k){for(var l=Tb.concat(Rb).concat(nc),c=0;c<l.length;c++)if(k.toLowerCase()===l[c].toLowerCase()){error_dialog("This font is already in the list below!");return}Bb(k)?(Tb.push(k),$(this).after(sb(k)),h.val("")):error_dialog("This font was not detected on your device. Try checking the spelling and ensuring the font is installed on your device.")}});g.on("click",".mm-font-show-google",function(){var h=
$(this),k=$('<div class="load">');h.hide().after(k);oc(function(){k.remove();h.after(Sb())},function(){k.remove();h.show()})});g.on("click",".mm-font-item-more-btn",function(){var h=$(this).closest(".mm-font-items").find(".mm-font-item").length;(h=pc(h))?$(this).before(h):$(this).remove()});g.on("change",".mm-font-latin-only",function(){Ub=$(this).hasClass("checked");$(this).closest(".mm-google-fonts").html(Sb())})}function sb(a,b){var d=esc(a),e="Impact"===a?"impact,impac":d;return'<div class="mm-font-item" title="'+
d+'" data-font="'+d+'" data-src="'+esc(b||"")+'" style="font-family:'+e+'">'+d+"</div>"}function mc(){for(var a=Tb.concat(Rb).concat(nc),b={},d=[],e=0;e<a.length;e++){var f=a[e];b[f]||(b[f]=!0,Bb(f)&&d.push(f))}if(!d.length)return"";a='<div class="mm-font-section-label">Other fonts on your device</div><div class="mm-font-add-label">Not seeing a font you have? Add it:</div><input class="mm-font-add-input" type="text" placeholder="Font name"/><button type="button" class="mm-font-add-btn l but">Add</button><div class="mm-font-items">';
for(e=0;e<d.length;e++)a+=sb(d[e]);return a+"</div>"}function Sb(){Qb(Ya);var a='<div class="mm-google-fonts"><div class="mm-font-section-label">Google Free Fonts<br/><small>sorted by popularity</small></div>'+cb("Latin Only",Ub,{className:"mm-font-latin-only"});a=a+'<div class="mm-font-items">'+pc(0);return a+'<div class="mm-font-item-more-btn l but">more</div></div></div>'}function pc(a){for(var b="",d=0,e=0,f=0;f<Ya.length&&(Ub&&1E6<Ya[f].filesize||(d>=a&&(b+=sb(Ya[f].family,Ya[f].src),e++),d++,
!(30<=e)));f++);return b}function oc(a,b){Cb||(Cb=!0,$.ajax({url:"/ajax_get_google_fonts",dataType:"json",success:function(d){Cb=!1;Ya=d.fonts;Qb(Ya);U();a&&a()},error:function(){Cb=!1;handleRequestError();b&&b()}}))}function Qb(a){for(var b="",d=0;d<a.length;d++){var e=a[d];e.src&&!qc[e.src]&&(b+="@font-face{font-family:'"+esc(e.family||e.name)+"';src:url("+e.src+")}",qc[e.src]=!0)}b&&$("head").append("<style>"+b+"</style>")}function Rc(){if(!wb())return[];var a=localStorage.getItem("fonts_used");
a=a?JSON.parse(a):{};var b=[],d;for(d in a)a.hasOwnProperty(d)&&2592E6>Date.now()-a[d].last_used&&b.push(a[d]);b.sort(function(e,f){return f.last_used-e.last_used});return b}function ub(a,b,d,e){function f(){h.updateColors()}function g(c){c=$(c.target);c.closest(l)[0]||c.closest(k)[0]||c.closest(".BOX,.mask-back")[0]||!$.contains(S.documentElement,c[0])||k.addClass("display-none")}d=d||{};b='<div class="mm-box-edit"><div class="mm-text-wrap"><textarea placeholder="'+esc(b)+'" class="mm-text"></textarea></div><div class="mm-font-options"><div class="color-picker mm-font-color-picker"></div>';
b=b+'<div class="color-picker mm-outline-color-picker"></div><div class="mm-font-options-btn-wrap"><button type="button" class="l but mm-font-options-btn" title="Font settings"><svg class="gear-icon" viewBox="0 0 22 22"><path d="M18.92 9.63a.33.33 0 0 0-.22-.13l-1.9-.3c-.1-.32-.25-.67-.43-1.01.12-.18.31-.42.56-.74.25-.31.43-.54.53-.69a.4.4 0 0 0 .09-.24c0-.1-.03-.17-.08-.23-.25-.35-.82-.94-1.72-1.77a.4.4 0 0 0-.26-.1c-.1 0-.18.03-.25.09l-1.48 1.11c-.28-.14-.6-.27-.93-.38l-.3-1.92a.3.3 0 0 0-.11-.22.4.4 0 0 0-.26-.09H9.85c-.2 0-.33.1-.38.3-.09.34-.19.98-.3 1.93-.33.1-.64.23-.95.4L6.78 4.51a.44.44 0 0 0-.27-.1c-.15 0-.48.24-.98.74s-.85.87-1.03 1.12a.44.44 0 0 0-.1.24c0 .08.04.17.11.25.47.56.84 1.04 1.12 1.44-.18.32-.31.64-.4.96l-1.95.29a.31.31 0 0 0-.2.13.4.4 0 0 0-.08.24v2.32c0 .09.03.17.09.24.05.07.12.12.22.13l1.9.28c.1.34.24.69.43 1.03l-.56.74c-.25.31-.43.54-.53.69a.4.4 0 0 0-.02.48c.28.37.85.96 1.72 1.75.08.08.17.11.26.11.1 0 .2-.03.26-.09l1.47-1.12c.29.15.6.28.94.4l.3 1.9c0 .1.04.17.11.23a.4.4 0 0 0 .26.09h2.31c.2 0 .33-.1.38-.3.09-.34.19-.98.3-1.93.32-.1.64-.23.95-.4l1.43 1.13c.1.06.2.1.27.1.16 0 .48-.25.98-.75.5-.49.85-.86 1.03-1.12.07-.07.1-.15.1-.24a.4.4 0 0 0-.1-.26c-.5-.61-.88-1.1-1.12-1.44.14-.26.27-.57.4-.95l1.93-.29a.32.32 0 0 0 .21-.13.4.4 0 0 0 .08-.24V9.87a.4.4 0 0 0-.08-.24m-6.03 3.27c-.52.52-1.15.78-1.89.78-.73 0-1.36-.26-1.88-.78A2.57 2.57 0 0 1 8.34 11c0-.74.26-1.36.78-1.89A2.57 2.57 0 0 1 11 8.34c.74 0 1.37.26 1.89.78.52.53.78 1.15.78 1.89s-.26 1.36-.78 1.89"/></svg></button><div class="mm-font-options-popup display-none ibox"><button type="button" class="lr but sml mm-box-remove-btn">remove</button><div class="mm-font-opt">Font <button type="button" class="mm-font-btn l but sml down-arrow"><span class="mm-font-label">Impact</span></button><input type="hidden" class="mm-font" name="font" value="impact"/></div><div class="mm-font-opt">'+
cb("ALL CAPS",!0,{className:"mm-all-caps"});b+=cb("<b>Bold</b>",!1,{className:"mm-font-bold"});b+=cb("<i>Italic</i>",!1,{className:"mm-font-italic"});b=b+'</div><div class="mm-font-opt">'+radioBtn("Shadow",!0,{className:"mm-outline-type"},"shadow");b+=radioBtn("Outline",!1,{className:"mm-outline-type"},"outline");b+=radioBtn("None",!1,{className:"mm-outline-type"},"none");b=b+'</div><div class="mm-font-opt">Outline Width <input class="ow" type="number" maxlength="1" min="0" max="9"/></div><div class="mm-font-opt">Max Font Size (px) <input class="mm-size" type="number" name="size" value="'+
((d.maxFontSize||W())+'" min="1" max="999"/></div>');b=$(b+'<div class="mm-font-opt">Text Align <div class="select sml"><select class="mm-text-align"><option value="center">Center</option><option value="left">Left</option><option value="right">Right</option></select></div></div><div class="mm-font-opt">Vertical Align <div class="select sml"><select class="mm-vertical-align"><option value="middle">Middle</option><option value="top">Top</option><option value="bottom">Bottom</option></select></div></div><div class="mm-font-opt">Opacity<div class="mm-box-opacity-slider"></div><input class="mm-box-opacity" type="number" value="1" min="0" max="1" step="0.1"/></div><div class="mm-font-opt"><div class="l but sml mm-box-bring-top-btn">Bring to top layer</div></div><div class="mm-font-opt"><button type="button" class="l but sml mm-font-apply-to-all">Apply these settings to ALL text boxes</button></div></div></div></div></div>');
L.find(".mm-boxes").append(b);var h=new rc(b,a,d);m.push(h);e&&h.autoResize(J().w,J().h,!0);var k=b.find(".mm-font-options-popup"),l=b.find(".mm-font-options-btn");l.on("click",function(){if(k.hasClass("display-none"))$d.on("click",g);else $d.off("click",g);k.toggleClass("display-none")});new jb(b.find(".mm-font-color-picker"),Za[1],Za,f,"Change Font Color");new jb(b.find(".mm-outline-color-picker"),Za[0],Za,f,"Change Outline Color");2<m.length&&Sc(h.$box);Db&&Db(b)}function Sc(a){a.css({background:"#fff"}).animate({opacity:0},
500,function(){$(this).css({background:"none",opacity:1})})}function vb(){Ca.naturalWidth?(ob?(x.save(),x.fillStyle=ob,x.fillRect(0,0,R.width,R.height),x.restore()):x.clearRect(0,0,R.width,R.height),0<J().rotation?(x.translate(R.width/2,R.height/2),x.rotate(J().rotation/180*Math.PI),180===J().rotation?(x.translate(-R.width/2,-R.height/2),x.drawImage(Ca,0,0,R.width,R.height),x.translate(R.width/2,R.height/2)):(x.translate(-R.height/2,-R.width/2),x.drawImage(Ca,0,0,R.height,R.width),x.translate(R.height/
2,R.width/2)),x.rotate(-J().rotation/180*Math.PI),x.translate(-R.width/2,-R.height/2)):x.drawImage(Ca,0,0,R.width,R.height)):x.clearRect(0,0,R.width,R.height);sc&&sc(x,R);x.shadowBlur=0;pa&&Na&&x.drawImage(pa,0,0);for(var a=!1,b=0;b<m.length;b++)if("image"!==m[b].type||m[b].hidden||m[b].draw(),"image"===m[b].type){var d=m[b].getVals();.85<d.w*d.h/(J().w*J().h)&&(a=!0)}a!==Eb&&(Eb=a,ba.find(".mm-preview-msg").toggleClass("display-none",!Eb).text(Eb?'NOTE: The image you added covers most of the template. It might look better if you select it with "Upload new template" or search.':
""));for(b=0;b<m.length;b++)"text"!==m[b].type||m[b].hidden||m[b].draw()}function Fb(){}function rc(a,b,d){function e(r){if(7!==r.length||1===f.opacity)return r;var v=parseInt(r.substr(1,2),16),u=parseInt(r.substr(3,2),16);r=parseInt(r.substr(5,2),16);return"rgba("+v+","+u+","+r+","+f.opacity+")"}d=d||{};var f=this;f.init(a);var g,h=a.find(".mm-all-caps").hasClass("checked"),k=a.find(".mm-outline-type.checked").data("value"),l=a.find(".mm-font-bold").hasClass("checked"),c=a.find(".mm-font-italic").hasClass("checked"),
n=a.find(".mm-text-align").val(),p=d.maxFontSize||a.find(".mm-size").val()>>0||W();f.type="text";f.outline_width=Gb[k];f.text="";f.font_color="#ffffff";f.outline_color="#000000";f.font=a.find(".mm-font").val()||"impact";var t=new Dragger(f.$box,Aa,function(){U();Hb&&Hb()},{enforceBoundary:!0,enableRotate:tc});t.bindMoveKeyEvents();var E=a.find(".mm-text");f.initEditSettings();a.find(".mm-font-btn").click(function(){Qc(function(r){Q(r)})});a.find(".mm-all-caps").change(function(){h=$(this).hasClass("checked");
P()});a.find(".mm-size").change(function(){p=g=Math.max(1,$(this).val()>>0);U()}).keyup(function(){p=g=Math.max(1,$(this).val()>>0);U()});a.find(".mm-outline-type").change(function(){k=$(this).data("value");f.outline_width=Gb[k];a.find(".ow").val(f.outline_width);U()});a.find(".mm-font-bold").change(function(){l=$(this).hasClass("checked");U()});a.find(".mm-font-italic").change(function(){c=$(this).hasClass("checked");U()});var M=function(){f.outline_width=$(this).val()>>0;"none"===k&&0<f.outline_width&&
(k="shadow",a.find(".mm-outline-type").removeClass("checked"),a.find('.mm-outline-type[data-value="shadow"]').addClass("checked"));U()};a.find(".ow").change(M).keyup(M).val(f.outline_width);a.find(".mm-vertical-align").change(function(){b=$(this).val();U()});a.find(".mm-text-align").change(function(){n=$(this).val();U()});a.find(".mm-font-apply-to-all").click(function(){for(var r=0;r<m.length;r++){var v=m[r],u=v.$edit;v!==f&&"text"===v.type&&(v.setFont(f.font),v.setFontMaxSize(p),v.setForceCaps(h),
u.find(".mm-outline-type").removeClass("checked"),u.find('.mm-outline-type[data-value="'+k+'"]').addClass("checked").change(),u.find(".mm-font-bold").toggleClass("checked",l).change(),u.find(".mm-font-italic").toggleClass("checked",c).change(),u.find(".ow").val(f.outline_width).change(),u.find(".mm-text-align").val(n).change(),u.find(".mm-box-opacity").val(f.opacity).change())}});var P=f.setText=function(r){r=r!==oa?r:E.val();f.text=h?r.toUpperCase():r;U()},Q=f.setFont=function(r){r=r.toLowerCase()||
"impact";a.find(".mm-font").val(r);a.find(".mm-font-label").text(r).attr("title",r);f.font=r;U()};f.getFont=function(){return f.font};f.isForcedCaps=function(){return h};f.setForceCaps=function(r){h=!!r;a.find(".mm-all-caps").toggleClass("checked",h);P()};f.outlineType=function(){return k};f.setOutlineType=function(r){k=r;a.find('.mm-outline-type[data-value="'+r+'"]').click();U()};f.isFontBold=function(){return l};f.isFontItalic=function(){return c};f.getFontMaxSize=function(){return p};f.setFontMaxSize=
function(r){a.find(".mm-size").val(r).change()};f.verticalAlign=function(){return b};f.textAlign=function(){return n};f.updateColors=function(){f.font_color=a.find(".mm-font-color-picker").data("picker").getColor();f.outline_color=a.find(".mm-outline-color-picker").data("picker").getColor();U()};f.setFontColor=function(r){a.find(".mm-font-color-picker").data("picker").setColor(r)};f.setOutlineWidth=function(r){a.find(".ow").val(r).change()};f.setOutlineColor=function(r){a.find(".mm-outline-color-picker").data("picker").setColor(r)};
f.getVals=function(){var r=t.getVals();return{x:r.x/aa,y:r.y/aa,w:r.w/aa,h:r.h/aa,rotation:r.rotation,font:f.font,font_size:g/1.32/aa>>0,font_max_size:p,font_color:f.font_color,font_shadow:"shadow"===k?1:0,outline_width:f.outline_width,outline_color:f.outline_color,force_caps:h?1:0,text_align:n,vertical_align:b}};f.setVals=function(r,v,u,w,F){t.setVals(r*aa>>0,v*aa>>0,u*aa>>0,w*aa>>0,F)};f.constrainVals=function(){t.constrainVals()};f.toggleDrag=function(r){t.toggleDrag(r)};f.dragEnabled=function(){return t.dragEnabled()};
f.setVerticalAlign=function(r){a.find(".mm-vertical-align").val(r).change()};f.setTextAlign=function(r){a.find(".mm-text-align").val(r).change()};f.setPlaceholder=function(r){a.find(".mm-text").attr("placeholder",r)};f.autoResize=function(r,v,u){if(u){r=r*aa-10;var w=v*aa/4;u=v=5;"bottom"===b?u=3*w-13:"middle"===b&&(u=1.5*w-2);var F=0}else w=Fa/Ob,F=t.getVals(),v=w*F.x,u=w*F.y,r=w*F.w,w*=F.h,F=F.rotation;t.setVals(v,u,r,w,F)};f.draw=function(){var r=t.getVals(),v=Z/Fa,u=r.x,w=r.y,F=r.w,X=r.h;12<r.w&&
(u=Math.round(v*r.x)+3,F=Math.round(v*r.w)-6);12<r.h&&(w=Math.round(v*r.y)+3,X=Math.round(v*r.h)-6);x.save();x.shadowBlur="shadow"===k?f.outline_width:0;x.shadowColor="shadow"===k?e(f.outline_color):"";x.fillStyle=e(f.font_color);for(var V=f.text,la=V.length,ca=2+la/30>>0,N=V.trim().split(/\s+/).length,Oa=[],db=/\r\n?|\n/g;v=db.exec(V);)Oa.push(v.index);v=Math.sqrt(la*X/F/2.8)+.5>>0;v=Math.max(Oa.length+1,Math.min(N,v));db=la/v;var va=[];N=[];for(var eb=[],K=0;K<la-1;){var qa=V.slice(K+1).search(/\s/);
if(-1!==qa)K=K+qa+1,eb.push(K);else break}qa=p;do{x.font=(l?"bold ":"")+(c?"italic ":"")+qa+"px "+f.font+("impact"===f.font?",impac":"");for(var G=0;G<=v;G++)if(0===G)va[G]=0;else if(G===v)va[G]=la;else{var wa=(db*G>>0)-ca;0>wa&&(wa=0);var Pa=-1,xa=Infinity;for(K=0;K<eb.length;K++){var da=Math.abs(eb[K]-wa);da<xa&&(Pa=eb[K],xa=da)}va[G]=Pa}for(G=0;G<Oa.length;G++)if(wa=Oa[G],-1===va.indexOf(wa)){Pa={};var $a=-1;xa=Infinity;for(K=1;K<va.length-1;K++){var ya=va[K];da=Math.abs(ya-wa);da<xa&&(-1===Oa.indexOf(ya)||
Pa[ya])&&($a=K,xa=da);Pa[ya]=!0}va[$a]=wa}Oa.length&&va.sort(function(Da,ea){return Da>ea?1:-1});for(G=0;G<v;G++)ya=G?va[G]+1:0,da=V.substr(ya,va[G+1]-ya),N[G]={text:da};xa=4+.1*qa;for(G=da=K=0;G<v;G++)N[G].w=x.measureText(N[G].text).width,N[G].h=N[G].text?.86*qa:0,N[G].w>K&&(K=N[G].w),da+=N[G].h+(G&&N[G].text?xa:0);G=Math.ceil(qa*Math.min(F/K,X/da));qa=G<qa?G:qa-1}while(K>F||da>X);g=qa;V=X-da;"top"===b&&(V=0);"middle"===b&&(V/=2);r.rotation&&(x.translate(u+F/2,w+X/2),x.rotate(r.rotation/180*Math.PI),
x.translate(-u-F/2,-w-X/2));la=V;for(K=0;K<v;K++)if(V="left"===n?0:"right"===n?F-N[K].w:(F-N[K].w)/2,la+=N[K].h+(K&&N[K].text?xa:0),da=N[K].text,"shadow"===k)for(ca=0;ca<(f.outline_width?6:1);ca++)x.fillText(da,u+V,w+la-2);else x.fillText(da,u+V,w+la-2),f.outline_width&&(x.strokeStyle=e(f.outline_color),x.lineWidth=f.outline_width,x.strokeText(da,u+V,w+la-2));r.rotation&&(x.translate(u+F/2,w+X/2),x.rotate(-r.rotation/180*Math.PI),x.translate(-u-F/2,-w-X/2));x.restore()};E.on("keyup change",function(){P()});
Qa.after(f.$box);d.coords&&(d=d.coords,t.setVals(d[0],d[1],d[2],d[3]))}function uc(a,b,d,e,f){var g=this;g.init(a);g.id=randHash(32);g.type="image";g.element=b;g.displayName=d;g.isPreset=!!e;g.templateId=f;g.radius=0;var h=new Dragger(g.$box,Aa,function(){U();Hb&&Hb()},{enforceBoundary:!1,enableRotate:tc});h.bindMoveKeyEvents();g.initEditSettings();new Slider(this.$edit.find(".mm-box-radius"),this.$edit.find(".mm-box-radius-slider"),0,{min:0,max:50,step:1,val:0,update:function(k){g.radius=k;U()}});
this.$edit.on("change",".mm-box-radius",function(){g.radius=Math.min(50,Math.max(0,$(this).val()));U()});g.getVals=function(){var k=h.getVals();return{x:k.x/aa>>0,y:k.y/aa>>0,w:k.w/aa>>0,h:k.h/aa>>0,rotation:k.rotation}};g.setVals=function(k,l,c,n,p){h.setVals(k*aa>>0,l*aa>>0,c*aa>>0,n*aa>>0,p)};g.constrainVals=function(){h.constrainVals()};g.toggleDrag=function(k){h.toggleDrag(k)};g.dragEnabled=function(){return h.dragEnabled()};g.autoResize=function(k,l,c){if(c)if(k=l=Math.min(k*aa/3>>0,l*aa/3>>
0),b.width>b.height){c=k;var n=b.height/b.width*c}else n=k,c=b.width/b.height*n;else{n=Fa/Ob;var p=h.getVals();k=n*p.x;l=n*p.y;c=n*p.w;n*=p.h}h.setVals(k,l,c,n)};g.draw=function(){var k=h.getVals(),l=Z/Fa,c=~~Math.round(l*k.x),n=~~Math.round(l*k.y),p=~~Math.round(l*k.w);l=~~Math.round(l*k.h);k.rotation&&(x.translate(c+p/2,n+l/2),x.rotate(k.rotation/180*Math.PI),x.translate(-c-p/2,-n-l/2));if(1!==g.opacity||g.radius)x.save(),x.globalAlpha=g.opacity;if(g.radius){var t=g.radius/100*Math.min(p,l);x.beginPath();
x.moveTo(c+t,n);x.arcTo(c+p,n,c+p,n+l,t);x.arcTo(c+p,n+l,c,n+l,t);x.arcTo(c,n+l,c,n,t);x.arcTo(c,n,c+p,n,t);x.closePath();x.clip()}x.drawImage(b,c,n,p,l);(1!==g.opacity||g.radius)&&x.restore();k.rotation&&(x.translate(c+p/2,n+l/2),x.rotate(-k.rotation/180*Math.PI),x.translate(-c-p/2,-n-l/2))};Qa.after(g.$box);g.autoResize(J().w,J().h,!0);h.lockRatio()}function vc(a){a.preventDefault();var b=a.clientX-$(this).offset().left+$(z).scrollLeft();a=a.clientY-$(this).offset().top+$(z).scrollTop();var d=Z/
Fa;b=Math.round(d*b);a=Math.round(d*a);ha.beginPath();x.beginPath();ha.moveTo(b,a);x.moveTo(b,a);x.save();x.lineCap="round";x.lineWidth=Ib;x.strokeStyle=fb;x.shadowColor=fb;x.shadowBlur=2;ha.lineCap="round";ha.lineWidth=Ib;ha.strokeStyle=fb;ha.shadowColor=fb;ha.shadowBlur=2;Sa=oa;wc(b+.001,a+.001);$("body").addClass("nosel");Qa.on("vmousemove",xc);$d.on("vmouseup",yc)}function xc(a){var b=a.clientX-$(this).offset().left+$(z).scrollLeft();a=a.clientY-$(this).offset().top+$(z).scrollTop();var d=Z/Fa;
b=Math.round(d*b);a=Math.round(d*a);wc(b,a)}function wc(a,b){ha.lineTo(a,b);x.lineTo(a,b);Jb?(ha.save(),ha.globalCompositeOperation="destination-out",ha.stroke(),ha.restore(),vb()):(ha.stroke(),x.stroke());ha.beginPath();x.beginPath();ha.moveTo(a,b);x.moveTo(a,b);Jb||(Na=!0)}function yc(){x.restore();$("body").removeClass("nosel");Qa.off("vmousemove",xc);$d.off("vmouseup",yc)}function zc(){$("#mm-select-my").hide();var a=$("#mm-select-popular");a.show();$(".mm-tab").removeClass("set");$("#memetab").addClass("set");
if(!a.html()){var b='<div class="im blank" data-key="blank" alt="Blank custom template" title="Make blank custom meme">Blank</div><div class="im ai" data-key="ai" alt="Custom template from AI" title="Make custom meme from AI">'+(icon("sparkle")+"AI</div>");var d=0,e="//s.imgflip.com/ms"+spriteNum+".jpg",f;for(f in q)if(q.hasOwnProperty(f)&&!isNaN(f)){var g='style="background:url('+e+") "+-50*d+'px 0px;"';d++;var h=esc(q[f].name);b+='<div class="im" '+g+' data-key="'+esc(f)+'" alt="'+h+' Meme Image" title="Make '+
h+' Meme"></div>'}a.append(b+'<a class="l but" tabindex="-1" id="allTemplates" href="/memetemplates">View All Meme Templates</a>')}}function Tc(){$("#mm-select-popular").hide();$("#mm-select-my").show();$(".mm-tab").removeClass("set");$("#mytab").addClass("set");Ac||(I.user.id||-1===z.location.href.search("memegenerator")?($.getJSON("/ajax_get_my_memes",function(a){if(a.error)MSG(a.error,"red");else{$.extend(q,a);var b="",d;for(d in a){a=q[d];var e=a.img?a.img.src:IMAGE_DOMAIN+"4/"+(+a.id).toString(36)+
"."+(a.has_transparency?"png":"jpg");b+="<img class='im um' src='"+esc(e)+"' data-key='"+esc(d)+"' title='"+esc(a.name)+"'/>"}b=b||"<div style='line-height:50px;padding-left:10px;'>Upload an image to create your first custom generator!</div>";$("#mm-select-my").append(b)}}),Ac=!0):$("#mm-select-my").append("<div style='line-height:50px;padding-left:10px;'><a rel='nofollow' href='/login?redirect=/memegenerator'>Login</a> or <a rel='nofollow' href='/signup?redirect=/memegenerator'>Signup</a> to view any custom templates you upload!"))}
function gb(a,b,d,e,f,g,h,k){b.removeClass("mm-hidden");var l=a.val().trim();if(!0===f||l!==a.data("previous_query")){g=!1!==g;var c=Date.now();Bc=c;a.data("previous_query",l);var n=l+(d?"@^":"")+(e?"^@":"")+(g?"^":"")+(h?"*":"")+(l?"":k);Vb[n]?Cc(b,Vb[n],l):(b.find(".mm-search-loading").addClass("mm-search-visible"),$.ajax({url:"/ajax_meme_search_new",data:{q:l,event_type:k,limit:100,transparent_only:e?1:0,include_nsfw:d?1:0,gifs_only:h?1:0,allow_gifs:g?1:0},dataType:"json",success:function(p){var t=
c===Bc;t&&b.find(".mm-search-loading").removeClass("mm-search-visible");if(p.error)error_dialog(p.error);else{for(var E=0;E<p.results.length;E++)hb[+p.results[E].id]=p.results[E];Vb[n]=p.results;t&&Cc(b,p.results,l)}}}))}}function Cc(a,b,d){for(var e="",f={},g=0;g<b.length;g++){f[b[g].result_type]=f[b[g].result_type]||[];var h=f[b[g].result_type],k=h.push,l=b[g];var c='<tr class="mm-search-result'+(10<=f[b[g].result_type].length?" display-none":"")+'" data-id="'+l.id+'">';c=c+'<td class="mm-search-result-img-td"><img class="mm-search-result-img" src="https:'+
(IMAGE_DOMAIN+"2/"+(+l.id).toString(36)+'.jpg"/>');c=c+'</td><td class="mm-search-result-text">'+esc(l.name);"mp4"===l.file_type&&(c+='<div class="mm-search-result-subtitle">animated</div>');+l.has_transparency&&(c+='<div class="mm-search-result-subtitle">contains transparency</div>');+l.pro_only&&(c+='<div class="mm-search-result-subtitle">premium</div>');k.call(h,c+"</td></tr>")}e=f.recent||""===d?e+Wb(f.recent,"recent","Recent Templates"):e+Wb(f.user,"user","Meme Templates");f.my&&(e+=Wb(f.my,
"my","My Templates"));e+='<div class="mm-search-view-all">';b=d?"/memesearch?q="+esc(encodeURIComponent(d)):"/memetemplates";e+='<a class="l but mm-search-view-all-btn" href="'+b+'">View All Meme Templates</a></div>';a.find(".mm-search-results-tables").html(e);a.removeClass("mm-hidden");a.data("latest_query",d)}function Wb(a,b,d){a=a||[];if("my"===b&&!a.length)return"";b='<table class="mm-search-results-table"><tr class="mm-search-section-title"><td colspan="2">'+d;a.length||(b+='<div class="mm-search-no-results">no results</div>');
b=b+"</td></tr>"+a.join("");10<a.length&&(b+='<tr class="mm-search-nav"><td colspan="2"><div class="l but mm-search-prev disabled">&lsaquo; Prev</div><div class="l but mm-search-next">Next &rsaquo;</div></td></tr>');return b+"</table>"}function Kb(a,b,d){$.ajax({url:"/ajax_meme_search_event",type:"post",dataType:"json",data:{meme_id:a,type:b,query:d.data("latest_query")}})}function Dc(a,b,d,e){for(var f="";b<d;b++)if(!e||a[b].pro_only)if(e||!a[b].pro_only){var g=~~a[b].id,h=a[b].name,k=a[b].pro_only?
1:"",l="https:"+IMAGE_DOMAIN+(a[b].use_thumbnail?"4/":"")+g.toString(36)+"."+a[b].file_type;f+='<div class="mm-quick-img-wrap" data-id="'+g+'" data-name="'+esc(h)+'" data-pro_only="'+k+'" title="'+esc(h)+'">';f+='<img class="mm-quick-img" src="'+esc(l)+'"/>';f+="</div>"}return f}function Xb(a,b,d,e){var f=new Image;"http"===a.substr(0,4)&&f.setAttribute("crossorigin","anonymous");$(f).load(function(){function g(c){c=$(c.target);c.closest(l)[0]||c.closest(k)[0]||k.addClass("display-none")}var h=$("<div class='mm-box-edit'>\n\t\t\t\t\t\t<button type='button' class='mm-box-remove' title='remove this image'>"+
X_SVG+"</button>\n\t\t\t\t\t\t<div class='mm-box-options-wrap'>\n\t\t\t\t\t\t\t<button type='button' class='mm-box-options-btn l but' title='image settings'><svg class=\"gear-icon\" viewBox=\"0 0 22 22\"><path d=\"M18.92 9.63a.33.33 0 0 0-.22-.13l-1.9-.3c-.1-.32-.25-.67-.43-1.01.12-.18.31-.42.56-.74.25-.31.43-.54.53-.69a.4.4 0 0 0 .09-.24c0-.1-.03-.17-.08-.23-.25-.35-.82-.94-1.72-1.77a.4.4 0 0 0-.26-.1c-.1 0-.18.03-.25.09l-1.48 1.11c-.28-.14-.6-.27-.93-.38l-.3-1.92a.3.3 0 0 0-.11-.22.4.4 0 0 0-.26-.09H9.85c-.2 0-.33.1-.38.3-.09.34-.19.98-.3 1.93-.33.1-.64.23-.95.4L6.78 4.51a.44.44 0 0 0-.27-.1c-.15 0-.48.24-.98.74s-.85.87-1.03 1.12a.44.44 0 0 0-.1.24c0 .08.04.17.11.25.47.56.84 1.04 1.12 1.44-.18.32-.31.64-.4.96l-1.95.29a.31.31 0 0 0-.2.13.4.4 0 0 0-.08.24v2.32c0 .09.03.17.09.24.05.07.12.12.22.13l1.9.28c.1.34.24.69.43 1.03l-.56.74c-.25.31-.43.54-.53.69a.4.4 0 0 0-.02.48c.28.37.85.96 1.72 1.75.08.08.17.11.26.11.1 0 .2-.03.26-.09l1.47-1.12c.29.15.6.28.94.4l.3 1.9c0 .1.04.17.11.23a.4.4 0 0 0 .26.09h2.31c.2 0 .33-.1.38-.3.09-.34.19-.98.3-1.93.32-.1.64-.23.95-.4l1.43 1.13c.1.06.2.1.27.1.16 0 .48-.25.98-.75.5-.49.85-.86 1.03-1.12.07-.07.1-.15.1-.24a.4.4 0 0 0-.1-.26c-.5-.61-.88-1.1-1.12-1.44.14-.26.27-.57.4-.95l1.93-.29a.32.32 0 0 0 .21-.13.4.4 0 0 0 .08-.24V9.87a.4.4 0 0 0-.08-.24m-6.03 3.27c-.52.52-1.15.78-1.89.78-.73 0-1.36-.26-1.88-.78A2.57 2.57 0 0 1 8.34 11c0-.74.26-1.36.78-1.89A2.57 2.57 0 0 1 11 8.34c.74 0 1.37.26 1.89.78.52.53.78 1.15.78 1.89s-.26 1.36-.78 1.89\"/></svg></button>\n\t\t\t\t\t\t\t<div class='mm-box-options-popup display-none ibox'>\n\t\t\t\t\t\t\t\t<div class='mm-font-opt'>\n\t\t\t\t\t\t\t\t\tOpacity\n\t\t\t\t\t\t\t\t\t<input class='mm-box-opacity' type='number' value='1' min='0' max='1' step='0.1'/>\n\t\t\t\t\t\t\t\t\t<div class='mm-box-opacity-slider'></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class='mm-font-opt'>\n\t\t\t\t\t\t\t\t\tRadius\n\t\t\t\t\t\t\t\t\t<input class='mm-box-radius' type='number' value='0' min='0' max='50' step='1'/>\n\t\t\t\t\t\t\t\t\t<div class='mm-box-radius-slider'></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class='mm-font-opt'><div class='l but sml mm-box-bring-top-btn'>Bring to top layer</div></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class='mm-img-box-name'>"+
esc(b)+"</div>\n\t\t\t\t\t</div>");L.find(".mm-boxes").append(h);m.push(new uc(h,f,b,d,e));var k=h.find(".mm-box-options-popup"),l=h.find(".mm-box-options-btn");l.on("click",function(){if(k.hasClass("display-none"))$d.on("click",g);else $d.off("click",g);k.toggleClass("display-none")});U();loading(!1);bb(!0);Db&&Db(h)});f.src=a}A=A||{};var D=this,Gb={shadow:5,outline:1,none:0},ba=$(A.$main||".mm-main"),pb=$(A.$previewOuter||"#mm-preview-outer"),Aa=$(A.$preview||".mm-preview"),Qa=Aa.find(".mm-canv"),
Ca=Aa.find(".mm-img")[0],L=$(A.$settings||"#mm-settings"),Ta=$("#mm-search"),qb=A.$drawPanel||pb.find(".mm-draw-panel"),Z,Ga,Fa=pb.width(),Ob=Fa,yb,Uc=A.noDraw,Yb=A.numTexts>>0,hc=!1,Za="#000000 #ffffff #995555 #ff3333 #ff8800 #eeee00 #22ee22 #00bff3 #3333ff #dd00cc".split(" "),Na=!1,ib=!1,Jb=!1,aa=1,tc=A.allowBoxRotation,ob="#ffffff",ua,ia="",Ja="",zb="#000000",lb="",Ec=!1,Eb=!1,Fc=A.selectCallback,Hb=A.draggerCallback,Db=A.boxAdded,Gc=A.boxRemoved,sc=A.preDraw,pa,Sa,ha,fb,Ib=5,m,ta,R=Qa[0];R.getContext&&
R.toDataURL&&R.getContext("2d")||alert("The Meme Generator requires a modern browser with HTML5 canvas support. Your browser is too old. Try Chrome or Firefox.");var x=R.getContext("2d");D.hideBox=function(a,b){return m[a].hidden?!1:(m[a].hidden=!0,b?vb():U(),!0)};D.showBox=function(a,b){return m[a].hidden?(m[a].hidden=!1,b?vb():U(),!0):!1};D.previewWidth=function(){return Fa};D.setMaxPreviewHeight=function(a){yb=a};D.canvasWidth=function(){return Z};D.canvasHeight=function(){return Ga};D.setCanvasWidth=
function(a){var b=W(),d=J();Z=Math.round(a);Ga=Math.round(d.h/d.w*Z);Qa.attr({width:Z,height:Ga});ja(Z,Ga);Na&&U();for(a=0;a<m.length;a++)"text"===m[a].type&&m[a].getFontMaxSize()===b&&m[a].setFontMaxSize(W());Y(Math.min(Z,pb.width()))};D.setTransparencyColor=function(a){ob=a};D.setFont=function(a){for(var b=0;b<m.length;b++)"text"===m[b].type&&m[b].setFont(a)};D.setForceCaps=function(a){for(var b=0;b<m.length;b++)m[b].setForceCaps&&m[b].setForceCaps(a)};D.ctx=function(){return x};D.canv=function(){return R};
var J=D.currentMeme=function(){return q[ta]};D.text=D.getText=function(a){if(a!==oa)return m[a]?(m[a].text||"").trim():"";a="";for(var b=0;b<m.length;b++)m[b].text&&(a+=(a?" ":"")+m[b].text.trim());return a};D.boxCount=function(a){for(var b=0,d=m.length-1;0<=d;d--)a&&m[d].type!==a||b++;return b};D.isEmpty=function(){return!D.getText()&&!D.boxCount("image")&&!Na};D.memeData=function(a,b){var d=[],e=0,f=0;a=a||Z/J().w;b=b||Ga/J().h;for(var g=0;g<m.length;g++){var h=m[g].getVals();d.push({type:m[g].type,
x:a*h.x>>0,y:b*h.y>>0,w:a*h.w>>0,h:b*h.h>>0,rotation:h.rotation,opacity:m[g].opacity});"text"===m[g].type?$.extend(d[g],{font_color:m[g].font_color,outline_width:m[g].outline_width,outline_color:m[g].outline_color,font:m[g].getFont(),font_size:h.font_size*b>>0,font_max_size:m[g].getFontMaxSize(),font_shadow:"shadow"===m[g].outlineType()?1:0,font_bold:m[g].isFontBold()?1:0,font_italic:m[g].isFontItalic()?1:0,force_caps:m[g].isForcedCaps()?1:0,text_align:m[g].textAlign(),vertical_align:m[g].verticalAlign(),
text:m[g].isForcedCaps()?m[g].text.toUpperCase():m[g].text}):"image"===m[g].type&&($.extend(d[g],{template_id:m[g].templateId,display_name:m[g].displayName,radius:m[g].radius}),e++,m[g].isPreset&&f++)}h=ua!==oa?q[ua]:J();return{boxes:d,template:100<h.id?h.id:"",template_url:J().template_url||"",templates:J().templates,num_imgs:e,num_scumbag_hats:f,transparency_color:L.find(".mm-transparency-color-wrap").hasClass("display-none")?"":ob,spacing_type:ia,spacing_color:"custom"===Ja?zb:Ja,spacing_size:lb,
effects:J().effects||"",has_drawing:Na?1:0}};var Vc=D.toggleSetDefaultSettingsBtn=function(){var a=I.user.id&&(3<=I.user.priv||I.user.id===q[ta].uid);L.find(".mm-set-default-settings").toggle(!!a)};D.ajaxSetDefaultSettings=function(){if(confirm("This will change the default text box settings for everyone who uses this template in the future, including text box positions, font family, and font colors. Are you sure you want to save your current text box settings as the default?")){for(var a=[],b=0;b<
m.length;b++)"text"===m[b].type&&a.push(m[b].getVals());loading("Saving text box settings");$.ajax({url:"/ajax_set_meme_positions",type:"post",dataType:"json",data:{meme_id:J().id,settings:a},success:function(d){loading(!1);d.error?error_dialog(d.error):MSG("Settings Saved!","green")}})}};D.reset=function(){if(D.isEmpty()||confirm("Are you sure you want to reset to an empty template?"))Na&&(pa.width=pa.width,Na=!1),$(".mm-text").val("").change(),$(".gen-anon,.gen-private").removeClass("checked"),
D.select(ua||ta),ib&&Hc()};D.removeBox=function(a){m[a].$box.remove();m[a].$edit.remove();m.splice(a,1);Gc&&Gc(a)};D.getBoxes=function(){return m};D.select=function(a,b,d){if("ai"===a)Mc();else if("spaced"!==a&&ua!==oa&&!1!==d&&ba.find(".mm-spacing-type").val("").change(),"blank"!==a||q.blank){var e=q[ta];ta=a;var f=q[a];d=f.w;var g=f.h;Z=O(f.w,f.h);Ga=f.h/f.w*Z;ma(Math.min(Z,pb.width()));if(!1!==b){for(b=m.length-1;0<=b;b--)"text"!==m[b].type&&D.removeBox(b);var h=Math.min(2,m.length);if(f.default_settings){var k=
JSON.parse(f.default_settings);h=k.length-m.length;for(b=0;b<h;b++)D.addText("middle");h=k.length}else 1<m.length&&(m[0].setVerticalAlign("top"),m[1].setVerticalAlign("bottom"),m[0].setPlaceholder("Top Text"),m[1].setPlaceholder("Bottom Text"));for(b=m.length-1;b>=h;b--)D.removeBox(b);h=[];e&&e.default_settings&&(h=JSON.parse(e.default_settings));for(b=0;b<m.length;b++)if(m[b].autoResize(d,g,!0),k&&k[b]){e=k[b];f.rotation||m[b].setVals(e.x,e.y,e.w,e.h,e.rotation);Pc(tb,e.font)||Bb(e.font)||oc();m[b].setFont(e.font);
m[b].setFontMaxSize(e.font_max_size!==oa?e.font_max_size:W());m[b].setFontColor(e.font_color);var l=e.font_shadow!==oa?e.font_shadow?"shadow":0<e.outline_width?"outline":"none":"shadow";m[b].setOutlineType(l);m[b].setOutlineWidth(e.outline_width!==oa?e.outline_width:Gb[l]);m[b].setOutlineColor(e.outline_color);m[b].setForceCaps(e.force_caps);m[b].setTextAlign(e.text_align);m[b].setVerticalAlign(e.vertical_align);m[b].setPlaceholder("Text #"+(b+1))}else{e=h[b]||{};e.font===m[b].getFont()&&m[b].setFont("impact");
e.font_max_size===m[b].getFontMaxSize()&&m[b].setFontMaxSize(W());e.font_color===m[b].font_color&&m[b].setFontColor("#ffffff");if(e.font_shadow===m[b].font_shadow||e.outline_width===m[b].outline_width)m[b].setOutlineType("shadow"),m[b].setOutlineWidth(Gb.shadow);e.outline_color===m[b].outline_color&&m[b].setOutlineColor("#000000");e.force_caps===m[b].isForcedCaps()&&m[b].setForceCaps(!0);e.text_align===m[b].textAlign()&&m[b].setTextAlign("center")}}k=sa(f);Qa.attr({width:Z,height:Ga});ja(Z,Ga);d=
$(Ca).attr("src");k!==d&&($(Ca).off("load").on("load",function(){var c=q[ua]||f;if(0!==c.has_transparency&&1!==c.has_transparency&&x.getImageData){var n=S.createElement("canvas"),p=Ca.naturalWidth,t=Ca.naturalHeight;n.width=p;n.height=t;n.getContext("2d").drawImage(Ca,0,0,p,t);c.has_transparency=Wc(n)?1:0}n=L.find(".mm-transparency-color-picker");c.has_transparency&&(n.data("picker")||new jb(n,ob,Za,function(E){ob=E;U()},"Change Transparency Color"));n.closest(".mm-transparency-color-wrap").toggleClass("display-none",
!c.has_transparency);U()}),k?("http"===k.substr(0,4)?Ca.setAttribute("crossorigin","anonymous"):Ca.removeAttribute("crossorigin"),$(Ca).attr("src",k)):d&&$(Ca).removeAttr("src"));U();$("#mm-meme-title").text(f.name||"Untitled Template").css({"font-weight":700});L.find(".mm-effect").each(function(){var c=$(this).find(".check-wrap");f.effects&&f.effects[$(this).data("type")]?(c.addClass("checked"),$(this).find("input").val(f.effects[$(this).data("type")]),$(this).find("input,.mm-effect-slider").removeClass("display-none")):
c.hasClass("checked")&&c.removeClass("checked").change()});L.find(".mm-blank-opts").toggleClass("display-none","blank"!==a);Vc();Fc&&Fc(f)}else La()};D.setMemes=function(a){q=a};D.addTextAuto=function(){var a=D.boxCount("text");ub(1<a?"middle":"top","Text #"+(a+1),{},!0);bb(!0)};D.init=function(){m=[];ta=0;if(!Uc){qb.html('<button type="button" class="mm-erase lr but sml">erase</button><button type="button" class="mm-erase-all lr but sml">erase all</button><button type="button" class="mm-draw-done-btn l but sml">Done</button><div class="mm-draw-color-picker"></div><div class="mm-draw-width-slider"></div>');
pa=$("<canvas/>")[0];ha=pa.getContext("2d");qb.on("click",".mm-erase",function(){Jb=!Jb;$(this).toggleClass("lr").toggleClass("r")});qb.on("click",".mm-erase-all",function(){confirm("Are you sure you want to erase your entire drawing?")&&(pa.width=pa.width,Na=!1,U())});var a=new Slider("",qb.find(".mm-draw-width-slider"),0,{min:1,max:32,val:Ib,showVal:!0,update:function(c){Ib=c}});fb=Za[3];a.setBG(fb);new jb(qb.find(".mm-draw-color-picker"),Za[3],Za,function(c){fb=c;a.setBG(c)},"Change Line Color")}1<
Yb&&ub("top","Top Text");0<Yb&&ub("bottom","Bottom Text");for(var b=2;b<Yb;b++)ub("middle","Text #"+(b+1));var d=$("#mm-select-popular"),e=$("#mm-search-dropdown"),f=e.find(".mm-search-nsfw"),g=e.find(".mm-search-gifs-only");Ta.on("keyup change paste focus",debounce(function(){Ta.is(":focus")&&gb(Ta,e,f.hasClass("checked"),!1,!1,!0,g.hasClass("checked"),"select")},300));f.on("change",function(){gb(Ta,e,f.hasClass("checked"),!1,!0,!0,g.hasClass("checked"),"select")});g.on("change",function(){gb(Ta,
e,f.hasClass("checked"),!1,!0,!0,g.hasClass("checked"),"select")});Ta.on("keydown",function(c){13===c.which&&(Ta.blur(),e.find(".mm-search-result").eq(0).click())});$d.on("click",function(c){c=$(c.target);c.closest(Ta)[0]||c.closest(e)[0]||e.addClass("mm-hidden")});e.on("click",".mm-search-result",function(){var c=+$(this).data("id");for(n in q)if(q.hasOwnProperty(n)&&+q[n].id===c){mm.select(n);e.addClass("mm-hidden");Kb(c,"select_meme_click",e);return}if("mp4"===hb[c].file_type)confirm("This meme is animated so you will be redirected to the GIF Maker. Continue?")&&
(loading("Opening GIF Maker"),setTimeout(function(){var t=hb[c],E=t.name.trim().replace(/\s+/,"-").replace(/[^a-zA-Z0-9\-]/,"");z.location="/gif-maker/"+(E?t.id+"/"+E:t.id)},500),Kb(c,"select_meme_click",e));else{q["search"+c]=hb[c];var n=IMAGE_DOMAIN+"2/"+(+c).toString(36)+".jpg";var p=hb[c].name;d.prepend('<img class="im" src="'+n+'" data-key="search'+esc(c)+'" alt="'+esc(p)+'" title="Caption '+esc('"'+p+'"')+'"/>');mm.select("search"+c);e.addClass("mm-hidden");Kb(c,"select_meme_click",e)}});$d.on("click",
".mm-search-prev,.mm-search-next",function(){for(var c=$(this).closest(".mm-search-results-table").find(".mm-search-result"),n=0,p=0;p<c.length;p++)if(!c.eq(p).hasClass("display-none")){n=p;break}$(this).hasClass("mm-search-next")?n<c.length-1&&(n+=10):0<n&&(n-=10);c.addClass("display-none");for(p=n;p<n+10;p++)c.eq(p).removeClass("display-none");$(this).parent().find(".mm-search-prev").toggleClass("disabled",0===n);$(this).parent().find(".mm-search-next").toggleClass("disabled",n>=c.length-10)});
L.on("click","#allTemplates",function(){var c=Ta.val();c&&$(this).attr("href","/memesearch?q="+encodeURIComponent(c))});Aa.hover(function(){m[0]&&m[0].dragEnabled()&&Aa.find(".drag-box").removeClass("off")},function(){m[0]&&m[0].dragEnabled()&&Aa.find(".drag-box").addClass("off")});L.find(".mm-add-text").click(D.addTextAuto);L.on("click",".mm-box-remove,.mm-box-remove-btn",function(){for(var c=$(this).closest(".mm-box-edit"),n=0;n<m.length;n++)if(m[n].$edit.is(c)){if(!confirm("Are you sure you want to remove this "+
("image"===m[n].type?"image":"text box")+"?"))break;D.removeBox(n);D.preview();break}});Ua.on("copy",function(c){var n=$(S.activeElement).closest(".drag-box");if(n.hasClass("drag-top"))for(var p=0;p<m.length;p++)m[p].$box.is(n)&&"image"===m[p].type&&((c.originalEvent||c).clipboardData.setData("text/plain","imgflip-box:"+m[p].id),c.preventDefault(),MSG(esc(m[p].displayName)+" copied!","green",2E3))});Ua.on("paste",function(c){var n=(c.originalEvent||c).clipboardData.getData("text");if(n=n?n.split("imgflip-box:")[1]:
"")for(c.preventDefault(),c=0;c<m.length;c++)m[c].id===n&&"image"===m[c].type&&Xb(m[c].element.src,m[c].displayName,m[c].isPreset,m[c].templateId)});L.find(".mm-reset").click(D.reset);L.find(".mm-toggle-drag").change(function(){bb($(this).hasClass("checked"))});L.find(".mm-no-watermark").change(function(){proType()||(kb("No Watermark","You can remove the imgflip.com watermark with Imgflip Pro Basic!"),$(this).removeClass("checked"))});L.find(".mm-output-original-resolution").change(function(){hc=
$(this).hasClass("checked");var c=J();D.setCanvasWidth(O(c.w,c.h));U()});L.find(".mm-add-effects").on("click",function(){L.find(".mm-effect-opts").toggleClass("display-none")});L.find(".mm-toggle-ai").on("click",function(){L.find(".mm-ai-opts").toggleClass("display-none");ra()});L.find(".mm-ai-generate").on("click",function(){na()});var h=debounce(za,200);L.find(".mm-effect").each(function(){var c=$(this),n=c.find(".check-wrap"),p=c.find("input"),t=c.find(".mm-effect-slider");Slider(p,t,0,{min:+p.attr("min"),
max:+p.attr("max"),step:+p.attr("step"),update:h});n.on("change",function(){n.hasClass("checked")?(p.add(t).removeClass("display-none"),p.val(c.data("initial")).change()):(p.add(t).addClass("display-none"),p.val(0).change())})});$("#mm-show-upload").click(jc);ba.on("click",".mm-add-img",function(){Xc()});ba.on("click",".mm-rotate",Wa);ba.on("click",".mm-add-spacing",function(){var c=ba.find(".mm-spacing-type");""===c.val()?c.val("top").change():c.val("").change()});ba.on("change",".mm-spacing-type,.mm-spacing-color,.mm-spacing-size",
Ia);var k=debounce(Ia,100);new jb(ba.find(".mm-spacing-color-picker"),zb,["#000000","#ffffff"],function(c){zb=c;k()});ba.on("change",".mm-blank-width,.mm-blank-height",La);ba.on("click",".mm-blank-ratio",Va);ba.on("click",".mm-draw-btn,.mm-draw-done-btn",Hc);Aa.on("click",".drag-box",function(){for(var c=$(this),n=0;n<m.length;n++)if(m[n].$box[0]===c[0]&&(m[n].text||"image"===m[n].type)&&!m[n].dragEnabled()){bb(!0);break}});L.find(".mm-toggle-opts").click(function(){var c=L.find(".mm-opts"),n=$(this);
"none"===c.css("display")?(c.slideDown(200),n.text("Hide Options")):(c.slideUp(200),n.text("More Options"))});L.on("click","#memetab",zc);L.on("click","#mytab",Tc);L.on("click",".im",function(){ic()&&!confirm("Switching templates will remove extra text and images you added. Continue?")||D.select($(this).data("key"))});L.on("mouseenter",".im",function(){var c=$(this).data("key");c=Lc[c]||q[c].name||"Untitled Template";$("#mm-meme-title").text(c).css({fontWeight:c===J().name?700:400})});L.on("mouseleave",
".im",function(){$("#mm-meme-title").text(J().name||"Untitled Template").css({fontWeight:700})});Qa.on("contextmenu",function(){z.ilog("canvas contextmenu")});var l=Ea.width();700>l&&bb(!1);Ea.resize(debounce(function(){var c=Ea.width();c!==l&&(l=c,Y(pb.width()))}))};D.initPopMemes=function(){zc()};var bb=D.toggleDrag=function(a){Aa.toggleClass("drag-disabled",!a);a?Aa.find(".drag-box").removeClass("off drag-top"):Aa.find(".drag-box").removeClass("drag-top");for(var b=0;b<m.length;b++)m[b].toggleDrag(a);
L.find(".mm-toggle-drag").toggleClass("checked",a)},Pb,Ab,Ha,Ic,Oc=debounce(function(a,b){var d=a.val();d!==Ic&&(Ic=d,a.removeClass("error"),d&&(isValidImgUrl(d)?(loading("Uploading image"),Zb(d,function(e,f){loading(!1);b.show();Ha=new ImageCropper(b,b.width(),b.width());Ha.setSrc(e,f);$("#mm-upload-btns").removeClass("display-none");Ab=d})):a.addClass("error")))},100),nb,lc,mb={"Courier New":!0,Impact:!0},tb="Impact;Arial;Comic Sans MS;Helvetica;Times New Roman;Times;Courier New;Courier;Verdana;Georgia;Palatino;Garamond;Bookman;Trebuchet MS;Arial Black".split(";"),
Rb="Al Bayan;Al Nile;Al Tarikh;American Typewriter;Andale Mono;Apple Braille;Apple Chancery;Apple Color Emoji;Apple SD Gothic Neo;Apple Symbols;AppleGothic;AppleMyungjo;Arial Hebrew;Arial Hebrew Scholar;Arial Narrow;Arial Unicode MS;Avenir;Avenir Next;Ayuthaya;Baghdad;Bangla MN;Bangla Sangam MN;Baskerville;Beirut;Big Caslon Medium;Bodoni 72;Bodoni Ornaments;Chalkboard;Chalkboard SE;Chalkduster;Cochin;Copperplate;Corsiva Hebrew;Damascus;DecoType Naskh;Devanagari MT;Devanagari Sangam MN;Didot;Diwan Kufi;Diwan Thuluth;Euphemia UCAS;Farah;Farisi;Futura;GB18030 Bitmap;Geeza Pro;Geneva;Gill Sans;Gujarati MT;Gujarati Sangam MN;Gurmukhi MN;Gurmukhi MT;Gurmukhi Sangam MN;Heiti SC;Heiti TC;Helvetica Neue;Herculanum;Hiragino Kaku Gothic StdN;Hiragino Maru Gothic ProN;Hiragino Mincho ProN;Hiragino Sans GB;Hiragino Sans;Hoefler Text;ITF Devanagari;ITF Devanagari Marathi;InaiMathi;Kailasa;Kannada MN;Kannada Sangam MN;Kefa;Khmer MN;Khmer Sangam MN;Kohinoor Bangla;Kohinoor Devanagari;Kohinoor Telugu;Kokonor;Krungthep;KufiStandardGK;Lao MN;Lao Sangam MN;Lucida Grande;Luminari;Malayalam MN;Malayalam Sangam MN;Marker Felt;Menlo;Microsoft Sans Serif;Mishafi Gold;Mishafi;Monaco;Mshtakan;Muna;Myanmar MN;Myanmar Sangam MN;Nadeem;New Peninim MT;Noteworthy;Optima;Oriya MN;Oriya Sangam MN;PT Mono;PT Sans;PT Sans Caption;PT Sans Narrow;PT Serif;PT Serif Caption;Papyrus;Phosphate;PingFang HK;PingFang SC;PingFang TC;Plantagenet Cherokee;Raanana;STIXGeneral;STIXIntegralsD;STIXIntegralsSm;STIXIntegralsUp;STIXIntegralsUpD;STIXIntegralsUpSm;STIXNonUnicode;STIXSizeFiveSym;STIXSizeFourSym;STIXSizeOneSym;STIXSizeThreeSym;STIXSizeTwoSym;STIXVariants;STSong;Sana;Sathu;Savoye LET Plain:1.0;Shree Devanagari 714;SignPainter-HouseScript;Silom;Sinhala MN;Sinhala Sangam MN;Skia;Snell Roundhand;Songti SC;Songti TC;Sukhumvit Set;Symbol;Tahoma;Tahoma Negreta;Tamil MN;Tamil Sangam MN;Telugu MN;Telugu Sangam MN;Thonburi;Times Roman;Trattatello;Waseem;Webdings;Wingdings;Wingdings2;Wingdings3;Zapf Dingbats;Zapfino".split(";"),
nc="Andalus;Angsana New;AngsanaUPC;Aparajita;Arabic Typesetting;Batang;BatangChe;Browallia New;BrowalliaUPC;Calibri;Cambria;Cambria Math;Candara;Consolas;Constantia;Corbel;Cordia New;CordiaUPC;DaunPenh;David;DFKai-SB;DilleniaUPC;DokChampa;Dotum;DotumChe;Ebrima;Estrangelo Edessa;EucrosiaUPC;Euphemia;FangSong;Franklin Gothic Medium;FrankRuehl;FreesiaUPC;Gabriola;Gautami;Gisha;Gulim;GulimChe;Gungsuh;GungsuhChe;IrisUPC;Iskoola Pota;JasmineUPC;KaiTi;Kalinga;Kartika;Khmer UI;KodchiangUPC;Kokila;Lao UI;Latha;Leelawadee;Levenim MT;LilyUPC;Lucida Console;Lucida Sans Unicode;Malgun Gothic;Mangal;Marlett;Meiryo;Meiryo UI;Microsoft Himalaya;Microsoft JhengHei;Microsoft New Tai Lue;Microsoft PhagsPa;Microsoft Sans Serif;Microsoft Tai Le;Microsoft Uighur;Microsoft YaHei;Microsoft Yi Baiti;MingLiU;MingLiU_HKSCS;MingLiU_HKSCS-ExtB;MingLiU-ExtB;Miriam;Miriam Fixed;Mongolian Baiti;MoolBoran;MS Gothic;MS Mincho;MS PGothic;MS PMincho;MS UI Gothic;MV Boli;Narkisim;NSimSun;Nyala;Palatino Linotype;Plantagenet Cherokee;PMingLiU;PMingLiU-ExtB;Raavi;Rod;Sakkal Majalla;Segoe Print;Segoe Script;Segoe UI;Segoe UI Light;Segoe UI Semibold;Segoe UI Symbol;Shonar Bangla;Shruti;SimHei;Simplified Arabic;Simplified Arabic Fixed;SimSun;SimSun-ExtB;Sylfaen;Symbol;Tahoma;Traditional Arabic;Tunga;Utsaah;Vani;Vijaya;Vrinda;Webdings;Wingdings".split(";"),
Tb=[],Ya=[],Ub=!0,Cb=!1,qc={};D.addText=ub;var U=debounce(vb,100,!1,100,!0);D.preview=U;D.previewInstantly=vb;Fb.prototype.init=function(a){this.$edit=a;this.opacity=1;this.$box=$("<div/>",{"class":"drag-box off"})};Fb.prototype.initEditSettings=function(){var a=this;new Slider(this.$edit.find(".mm-box-opacity"),this.$edit.find(".mm-box-opacity-slider"),0,{min:0,max:1,step:.01,val:1,update:function(d){a.opacity=d;U()}});this.$edit.on("change",".mm-box-opacity",function(){a.opacity=Math.min(1,Math.max(0,
$(this).val()));U()});var b=function(){Aa.find(".drag-box").removeClass("off").removeClass("drag-top");a.$box.addClass("drag-top")};this.$box.on("vmousedown",function(){b();a.$box.attr("tabindex",0).focus()});this.$edit.on("click",".mm-box-bring-top-btn",b)};inherits(rc,Fb);inherits(uc,Fb);var Hc=D.toggleDraw=function(){pb.find(".mm-top-panel").toggleClass("display-none",!ib);qb.toggleClass("display-none",ib);Aa.toggleClass("mm-drawing",!ib);if(ib)Qa.off("vmousedown",vc);else Qa.on("vmousedown",vc);
ib=!ib},Ac=!1,Vb={},hb={},Bc,Xc=D.showAddImagePopup=function(a,b,d){function e(){return c.find(".mm-add-img-show-nsfw").hasClass("checked")}function f(){return c.find(".mm-add-img-transparent-only").hasClass("checked")}function g(u,w,F,X,V){var la=sa(J()),ca=new Image,N=new Image;"http"===la.substr(0,4)&&ca.setAttribute("crossorigin","anonymous");"http"===u.substr(0,4)&&N.setAttribute("crossorigin","anonymous");var Oa=V.hasClass("mm-add-img-type-below"),db=V.hasClass("mm-add-img-type-above"),va=V.hasClass("mm-add-img-type-left"),
eb=!1;V=function(){if(eb){var K=S.createElement("canvas"),qa=K.getContext("2d");if(Oa||db){var G=Math.max(ca.width,N.width),wa=G/ca.width*ca.height;var Pa=G/N.width*N.height;var xa=G/ca.width;K.width=G;K.height=wa+Pa;qa.drawImage(ca,0,0,ca.width,ca.height,0,Oa?0:Pa,G,wa);qa.drawImage(N,0,0,N.width,N.height,0,Oa?wa:0,G,Pa)}else{G=Math.max(ca.height,N.height);wa=G/ca.height*ca.width;var da=G/N.height*N.width;xa=G/ca.height;K.width=wa+da;K.height=G;qa.drawImage(ca,0,0,ca.width,ca.height,va?da:0,0,wa,
G);qa.drawImage(N,0,0,N.width,N.height,va?0:wa,0,da,G)}var $a=new Image;$($a).load(function(){var ya=J().templates||[{id:J().id,url:J().template_url}],Da={id:w,url:X,display_name:F};db||va?ya.unshift(Da):ya.push(Da);q.custom={id:0,templates:ya,name:"Custom Image",img:$a,w:$a.width,h:$a.height};ya=[];for(Da=0;Da<m.length;Da++){var ea=m[Da].getVals();1<xa&&(ea.x=Math.round(ea.x*xa),ea.y=Math.round(ea.y*xa),ea.w=Math.round(ea.w*xa),ea.h=Math.round(ea.h*xa));db?ea.y+=Pa:va&&(ea.x+=da);ya.push(ea)}D.select("custom",
!1);for(Da=0;Da<ya.length;Da++)ea=ya[Da],m[Da].setVals(ea.x,ea.y,ea.w,ea.h,ea.rotation);L.find(".mm-toggle-drag").hasClass("checked")||bb(!0);loading(!1)});Lb(K,$a)}else eb=!0};$(ca).load(V);$(N).load(V);ca.src=la;N.src=u}function h(u,w){if(0!==u.type.indexOf("image"))error_dialog("That file is not an image!");else{var F=new FileReader;F.onload=function(X){t.show();M=new ImageCropper(t,t.width(),t.width());M.setSrc(X.target.result,u.name);c.find(".mm-add-img-btns,.mm-add-img-submit,.mm-add-img-public-wrap").removeClass("display-none");
c.find(".mm-add-img-search-wrap,.mm-quick-imgs").hide();P=(w?"paste:":"")+u.name};F.readAsDataURL(u)}}function k(u){loading("Loading template");var w=sa(u);"/"===w[0]&&(w=location.protocol+"//"+location.host+w);Zb(w,function(F){loading(!1);t.show();M=new ImageCropper(t,t.width(),t.width());M.setSrc(F,u.name,u.id);c.find(".mm-add-img-btns,.mm-add-img-submit").removeClass("display-none")})}function l(){if(proType())return!0;I.done?z.showProPopup?showProPopup("You can use premium images and much more with Imgflip Pro!",
currentMediaSource()+"_pro_img"):kb("Pro Img","You can use premium images with Imgflip Pro Basic"):error_dialog("Page is not finished loading yet. Try again in a few seconds or refresh.");return!1}b=b||Xb;d=!1!==d;a='<div class="mm-add-img-popup"><div class="mm-add-img-types concise'+((a?" display-none":"")+'"><div class="mm-add-img-type mm-add-img-type-inside selected"><div class="mm-add-img-type-title">Inside</div>');a+='<div class="mm-add-img-type-diagram"><div class="mm-add-img-current"></div><div class="mm-add-img-new"></div></div>';
a+="</div>";a+='<div class="mm-add-img-type mm-add-img-type-below">';a+='<div class="mm-add-img-type-title">Below</div>';a+='<div class="mm-add-img-type-diagram"><div class="mm-add-img-current"></div><div class="mm-add-img-new"></div></div>';a+="</div>";a+='<div class="mm-add-img-type-more a" data-swap="Less">More</div>';a+='<div class="mm-add-img-type mm-add-img-type-above">';a+='<div class="mm-add-img-type-title">Above</div>';a+='<div class="mm-add-img-type-diagram"><div class="mm-add-img-current"></div><div class="mm-add-img-new"></div></div>';
a+="</div>";a+='<div class="mm-add-img-type mm-add-img-type-left">';a+='<div class="mm-add-img-type-title">Left</div>';a+='<div class="mm-add-img-type-diagram"><div class="mm-add-img-current"></div><div class="mm-add-img-new"></div></div>';a+="</div>";a+='<div class="mm-add-img-type mm-add-img-type-right">';a+='<div class="mm-add-img-type-title">Right</div>';a+='<div class="mm-add-img-type-diagram"><div class="mm-add-img-current"></div><div class="mm-add-img-new"></div></div>';a+="</div>";a+="</div>";
d&&(a+='<div class="mm-quick-imgs">',a+=Dc(y,0,y.length),a+='<button type="button" class="mm-quick-img-more-btn a">More</button>',a+='<div class="mm-quick-imgs-more display-none"></div>',a+="</div>");a+='<div class="mm-add-img-choose-img">';a+='<div class="mm-add-img-upload-btn file-button l but">Upload Image<input type="file" class="hidden-file-input"/></div>';a+='<input class="mm-add-img-url" type="url" placeholder="Paste image URL"/>';a+='<div class="mm-add-img-btns display-none">';a+='<button type="button" class="mm-add-img-rotate l but sml">'+
ROTATE_SVG+"</button>";a+='<button type="button" class="mm-add-img-flip l but sml">flip</button>';a+="</div>";a+='<div class="mm-add-img-preview-wrap"></div>';a+='<div class="mm-add-img-public-wrap display-none">'+cb("Allow this image to be shared publicly",!1,{className:"mm-add-img-public"})+'</div><div class="mm-add-img-public-settings">Name <input class="mm-add-img-name" type="text" maxlength="64" placeholder="e.g. Funny Hat"/>Alternate Names (comma-separated) <input class="mm-add-img-alt-names" type="text" maxlength="255" placeholder="e.g. Silly Hat, Weird Top Hat"/>Description <textarea class="mm-add-img-description" maxlength="512" placeholder="e.g. more info about this image and how it could be used"></textarea>'+
(I.user.id?cb("Anonymous <small>(not shown with your username)</small>",!1,{className:"mm-add-img-anon"}):"")+"</div>";a+='<button type="button" class="mm-add-img-submit b but display-none">Add Image</button>';a+='<div class="mm-add-img-search-wrap">';a+='<div class="mm-add-img-or">OR</div>';a+='<input class="mm-add-img-search" type="text" placeholder="Search Memes"/>';a+='<div class="mm-add-img-search-opts hidden">';a+=cb("Include NSFW",!1,{className:"mm-add-img-show-nsfw",title:"Include not-safe-for-work templates"});
a+=cb("Transparent Background",d,{className:"mm-add-img-transparent-only",title:"Only show templates containing transparency"});a+="</div>";a+='<div class="mm-search-results mm-hidden shadow ibox">';a+='<div class="mm-search-loading">loading...</div>';a+='<div class="mm-search-results-tables"></div>';a+="</div>";a+="</div>";a+="</div>";a+="</div>";var c=$(a),n=c.find(".mm-add-img-search"),p=c.find(".mm-search-results"),t=c.find(".mm-add-img-preview-wrap"),E=new Box({html:c,w:360}),M,P,Q,r=debounce(function(u){var w=
u.val();w!==Q&&(Q=w,u.removeClass("error"),w&&(isValidImgUrl(w)?(loading("Uploading image"),Zb(w,function(F,X){loading(!1);t.show();M=new ImageCropper(t,t.width(),t.width());M.setSrc(F,X,0,w);c.find(".mm-add-img-btns,.mm-add-img-submit,.mm-add-img-public-wrap").removeClass("display-none");c.find(".mm-add-img-search-wrap,.mm-quick-imgs").hide();P=w})):u.addClass("error")))},100);c.on("vclick",".mm-add-img-type",function(u){var w=$(this);w.parent().find(".mm-add-img-type").removeClass("selected");w.addClass("selected");
w=w.hasClass("mm-add-img-type-inside");c.find(".mm-quick-imgs").toggle(w);var F=c.find(".mm-add-img-transparent-only");F.toggleClass("checked",w);p.hasClass("mm-hidden")||F.change();return cancelEvent(u)});c.on("vclick",".mm-add-img-type-more",function(){$(".mm-add-img-types").toggleClass("concise");var u=$(this),w=u.data("swap");u.data("swap",u.text());u.text(w)});c.on("change",".mm-add-img-show-nsfw",function(){$(this).hasClass("checked")?(Ec||confirm("This will allow any user-uploaded meme template to display in the search results, which may contain not-safe-for-work content. Are you sure you want to include NSFW templates?")?
gb(n,p,e(),f(),!0,!1,!1,"add"):$(this).removeClass("checked"),Ec=!0):gb(n,p,e(),f(),!0,!1,!1,"add")});c.on("change",".mm-add-img-transparent-only",function(){gb(n,p,e(),f(),!0,!1,!1,"add")});var v=!0;c.on("keyup change paste focus",".mm-add-img-search",debounce(function(){gb(n,p,e(),f(),!1,!1,!1,"add");v&&(c.find(".mm-add-img-search-opts").removeClass("hidden"),v=!1)},300));c.on("vclick",".mm-search-result",function(u){var w=$(this).data("id");if(w){if(+hb[w].pro_only&&!l())return cancelEvent(u);
Kb(w,"add_image_click",p);k(hb[w]);return cancelEvent(u)}});c.on("change",".mm-add-img-upload-btn input",function(){Kc?this.files[0]&&h(this.files[0]):error_dialog("Your browser must have HTML5 File support to upload an image. Try upgrading to a modern browser.")});c.on("keyup change paste",".mm-add-img-url",function(u){var w=(u.originalEvent||u).clipboardData;if(w&&w.items){w=w.items;for(var F=0;F<w.length;F++)if(0===w[F].type.indexOf("image")){var X=w[F].getAsFile();if(X)return h(X,!0),cancelEvent(u)}}r($(this))});
c.on("click",".mm-add-img-submit",function(){var u=function(){var w=M.getFinalDataUrl("image/png"),F=M.getTemplateId(),X=M.getFilename(),V=M.getOriginalUrl();loading("Adding image");c.find(".mm-add-img-type-inside").hasClass("selected")?b(w,X,!1,F):g(w,F,X,V,c.find(".mm-add-img-type.selected"));E.hide()};c.find(".mm-add-img-public").hasClass("checked")?(loading("Uploading new image"),$.ajax({url:"/ajax_upload_template",type:"post",dataType:"json",data:{img_data:M.getFinalDataUrl("image/png"),template_url:P,
template_name:c.find(".mm-add-img-name").val(),template_alt_names:c.find(".mm-add-img-alt-names").val(),template_description:c.find(".mm-add-img-description").val(),template_anon:c.find(".mm-add-img-anon").hasClass("checked")?1:0},success:function(w){w.error?(loading(!1),error_dialog(w.error)):(M.setTemplateId(w.id),u())}})):u()});c.on("click",".mm-add-img-rotate",function(){M.rotateClockwise()});c.on("click",".mm-add-img-flip",function(){M.flipHorizontal()});c.on("click",".mm-quick-img-wrap",function(){if(!$(this).data("pro_only")||
l())E.hide(),loading("Adding Image"),Xb($(this).find("img").attr("src").replace("/4/","/"),$(this).data("name"),!0,$(this).data("id"))});c.on("click",".mm-quick-img-more-btn",function(){var u=c.find(".mm-quick-imgs-more"),w=u.hasClass("display-none");if(w){if(!u.children().length){var F='<div class="mm-quick-img-note">Popular User Uploads</div>'+Dc(C,0,C.length);u.html(F)}u.removeClass("display-none")}else u.addClass("display-none");$(this).text(w?"Less":"More")});c.on("change",".mm-add-img-public",
function(){c.find(".mm-add-img-public-settings").toggle($(this).hasClass("checked"))})}};var kb=z.showProBasicPopup=function(q,y){var C=$("#pro-basic-popup-wrap").html();C='<div class="pro-basic-popup"><div class="pro-popup-msg-plain">'+(y||"")+"</div>"+C+'</div><div class="pro-popup display-none"><button type="button" class="pro-popup-back-btn a">&larr; Back to Pro Basic</button>';C+=$("#pro-popup-wrap").html();C+="</div>";var A=BOX.show({html:C});initProBtn(A.el().find(".pro-basic-popup"),"pro_basic",
function(){return A.hide()});A.el().on("click",".pro-popup-back-btn",function(){A.el().find(".pro-basic-popup,.pro-popup").toggleClass("display-none");proEvent("pro_basic","Switch back from pro");A.recenter();initProBtn(A.el().find(".pro-basic-popup"),"pro_basic",function(){return A.hide()})});A.el().on("click",".pro-basic-popup-pro-btn",function(){A.el().find(".pro-basic-popup,.pro-popup").toggleClass("display-none");proEvent("pro","Switch from pro basic");A.recenter();initProBtn(A.el().find(".pro-popup"),
"pro",function(){return A.hide()})});proEvent("pro_basic","Clicked "+q)},Zb=z.getDataUrlFromImgUrl=function(q,y){var C=new Image;C.setAttribute("crossorigin","anonymous");var A="";z.URL&&(A=((new URL(q)).pathname||"/").substr(1));$(C).load(function(){var Y=S.createElement("canvas");Y.width=this.naturalWidth;Y.height=this.naturalHeight;Y.getContext("2d").drawImage(this,0,0);try{y(Y.toDataURL("image/png"),A)}catch(ma){bc(q,y,A)}}).on("error",function(){bc(q,y,A)});C.src=q};z.ColorPicker=jb;var Wc=z.containsTransparency=
function(q){var y=q.width,C=q.height;q=q.getContext("2d");if(!q.getImageData)return!1;q=q.getImageData(0,0,y,C).data;for(var A=0,Y=0;1E3>Y;Y++)if(255>q[(Math.random()*C>>0)*y*4+4*(Math.random()*y>>0)+3]&&(A++,.01<A/1E3))return!0;return!1},Nb=!1;z.generate=Mb;z.imgDonePopup=dc;z.imgDone=ec;var $b=z.memes&&z.memes[z.initMeme]?z.memes[z.initMeme].id:0,ac={};z.ajaxUpdateRecommendedMemes=function(q){q&&q.id&&q.id!==$b&&($b=q.id,ac[q.id]?$("#mm-recs-wrap").html(ac[q.id]):$.ajax({url:"/ajax_get_meme_recs",
data:{meme_id:q.id},success:function(y){y.error||(ac[y.meme_id]=y.html,+y.meme_id===+$b&&$("#mm-recs-wrap").html(y.html))}}))};memeInit=function(){$(".mm-generate").click(function(){Mb(Jc,!1,!0)});Ua.on("click",".mm-set-default-settings",function(){mm.ajaxSetDefaultSettings()});Ua.on("click",".mm-show-pro-basic",function(){kb("FAQ","You can remove the imgflip.com watermark with Imgflip Pro Basic!")});if("#imgUrl="===location.hash.substr(0,8)){var q=location.hash.substr(8).split("&")[0];q&&($("#mm-show-upload").click(),
$("#mm-upload-url").val(decodeURIComponent(q)).change(),history.replaceState(null,S.title,location.href.split("#")[0]))}$w.on("beforeunload",function(){return $("#done")[0]||mm.isEmpty()?oa:!0});!proType()&&z.sfw&&($(".head").prepend(adCode("ad","leaderboard_atf")),$(".gen-bottom-ad").append(adCode("","leaderboard_btf")))};showGenerator=function(q){if(!I.user.id)showLogin();else if(!q.data("meme-iid")||confirm("You already have a meme attached to this comment, are you sure you want to overwrite it?"))loading("Materializing Meme Generator"),
$.ajax({dataType:"json",url:"/ajax_get_meme_generator",success:function(y){loading(!1);if(y.error)error_dialog(y.error);else{var C=BOX.show({html:y.html,bg:"transparent",noMaskClick:!0});mm=new MemeMaker(y.memes,y.quick_add_imgs,y.quick_trans_imgs,{allowBoxRotation:!0,numTexts:2});mm.init();mm.initPopMemes();mm.select(0);proType()||$(".gen-no-watermark-wrap").hide();C.el().on("click",".mm-generate",function(){loading("Generating Meme");Mb(function(A){q.find(".c-pending-img").remove();q.data("meme-iid",
A.iid).addClass("has-pending-img").prepend('<img class="c-pending-img" src="'+IMAGE_DOMAIN+(+A.iid).toString(36)+'.jpg"/>');loading(!1);C.hide()},!0)})}}})}})(window,document,$(window),$(document));
